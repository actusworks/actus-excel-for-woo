(()=>{var N=window.jQuery||jQuery,ke=class d{constructor(e={}){this.options={title:"",content:"",size:"medium",closeButton:!0,closeOnOverlay:!1,closeOnEscape:!0,animation:"fade",buttons:[],className:"",onOpen:null,onClose:null,beforeClose:null,focusTrap:!0,...e},this.isOpen=!1,this.$modal=null,this.$overlay=null,this.previousFocus=null,this.id=`modal-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,this.create(),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleOverlayClick=this.handleOverlayClick.bind(this)}create(){let e=`actus-modal-${this.options.size}`,t=`actus-modal-animation-${this.options.animation}`,s=this.options.className?this.options.className:"";this.$overlay=N(`
			<div class="actus-modal-overlay" data-modal-id="${this.id}">
				<div class="actus-modal acex-main ${e} ${t} ${s}" role="dialog" aria-modal="true" aria-labelledby="${this.id}-title">
					<div class="actus-modal-container">
						${this.options.closeButton?'<button class="actus-modal-close" aria-label="Close modal">&times;</button>':""}
						${this.options.title?`<div class="actus-modal-header"><h2 id="${this.id}-title" class="actus-modal-title">${this.options.title}</h2></div>`:""}
						<div class="actus-modal-body"></div>
						${this.options.buttons.length>0?'<div class="actus-modal-footer"></div>':""}
					</div>
				</div>
			</div>
		`),this.$modal=this.$overlay.find(".actus-modal"),this.$container=this.$modal.find(".actus-modal-container"),this.$body=this.$modal.find(".actus-modal-body"),this.setContent(this.options.content),this.options.buttons.length>0&&this.addButtons(this.options.buttons),this.$overlay.hide().appendTo("body"),this.bindEvents()}setContent(e=""){let t=this.$modal.find(".actus-modal-body");return typeof e=="string"?t.html(e):e instanceof jQuery||e instanceof HTMLElement?t.empty().append(e):t.html(""),this}addContent(e){let t=this.$modal.find(".actus-modal-body");return(typeof e=="string"||e instanceof jQuery||e instanceof HTMLElement)&&t.append(e),this}addButtons(e){let t=this.$modal.find(".actus-modal-footer");return t.empty(),e.forEach(s=>{let a=N(`<button class="actus-btn ${s.class||""}">${s.text||""}</button>`);s.onClick&&a.on("click",i=>{i.preventDefault(),s.onClick(this,i)}),t.append(a)}),this}bindEvents(){this.options.closeButton&&this.$modal.find(".actus-modal-close").on("click",e=>{e.preventDefault(),this.destroy()}),this.options.closeOnOverlay&&this.$overlay.on("click",this.handleOverlayClick.bind(this)),this.$modal.on("click",e=>{e.stopPropagation()})}handleOverlayClick(e){N(e.target).hasClass("actus-modal-overlay")&&this.destroy()}handleKeyDown(e){e.keyCode===27&&this.options.closeOnEscape&&(e.preventDefault(),this.destroy()),e.keyCode===9&&this.options.focusTrap&&this.trapFocus(e)}trapFocus(e){let t=this.$modal.find('a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])');if(t.length===0)return;let s=t.first()[0],a=t.last()[0];e.shiftKey?document.activeElement===s&&(e.preventDefault(),a.focus()):document.activeElement===a&&(e.preventDefault(),s.focus())}open(){return this.isOpen?this:(this.previousFocus=document.activeElement,this.$overlay.show(),setTimeout(()=>{this.$overlay.addClass("actus-modal-open"),this.$modal.addClass("actus-modal-active")},10),N("body").addClass("actus-modal-is-open"),N(document).on(`keydown.modal-${this.id}`,this.handleKeyDown),setTimeout(()=>{let e=this.$modal.find('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])').first();e.length?e.focus():this.$modal.focus()},100),this.isOpen=!0,typeof this.options.onOpen=="function"&&this.options.onOpen(this),N(document).trigger("acex::modal:open",[this]),this)}close(){return this.isOpen?typeof this.options.beforeClose=="function"&&this.options.beforeClose(this)===!1?this:(this.$overlay.removeClass("actus-modal-open"),this.$modal.removeClass("actus-modal-active"),setTimeout(()=>{this.$overlay.hide()},300),N(".actus-modal-overlay.actus-modal-open").length===0&&N("body").removeClass("actus-modal-is-open"),N(document).off(`keydown.modal-${this.id}`),this.previousFocus&&this.previousFocus.focus(),this.isOpen=!1,typeof this.options.onClose=="function"&&this.options.onClose(this),N(document).trigger("acex::modal:close",[this]),this):this}toggle(){return this.isOpen?this.close():this.open()}updateContent(e){return this.setContent(e),this}updateTitle(e){let t=this.$modal.find(".actus-modal-title");if(t.length)t.html(e);else if(e){let s=N(`<div class="actus-modal-header"><h2 id="${this.id}-title" class="actus-modal-title">${e}</h2></div>`);this.$modal.find(".actus-modal-container").prepend(s)}return this}updateButtons(e){this.options.buttons=e;let t=this.$modal.find(".actus-modal-footer");return!t.length&&e.length>0&&(t=N('<div class="actus-modal-footer"></div>'),this.$modal.find(".actus-modal-container").append(t)),this.addButtons(e),this}getBody(){return this.$modal.find(".actus-modal-body")}getFooter(){let e=this.$modal.find(".actus-modal-footer");return e.length||(e=N('<div class="actus-modal-footer"></div>'),this.$modal.find(".actus-modal-container").append(e)),e}showLoading(e="Loading..."){return this.getBody().html(`
			<div class="actus-modal-loading">
				<div class="actus-spinner"></div>
				<p>${e}</p>
			</div>
		`),this}destroy(){this.close(),N(document).off(`keydown.modal-${this.id}`),setTimeout(()=>{this.$overlay&&this.$overlay.remove(),this.$modal=null,this.$overlay=null},300)}static message(e,t,s="",a={}){let{errorMessage:i="",details:o={},points:r=[],helpText:n="Please try again or contact support if the problem persists.",buttonText:c=null,button2:l={},onClose:u=null}=a,h="",p="",m="OK";switch(e){case"error":m="Close",p=t||"Error",h=`
					<div class="acex-error-message">
						<div class="acex-error-icon">
							<svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<circle cx="12" cy="12" r="10" stroke="#dc3545" stroke-width="2"/>
								<path d="M12 8V12" stroke="#dc3545" stroke-width="2" stroke-linecap="round"/>
								<circle cx="12" cy="16" r="1" fill="#dc3545"/>
							</svg>
						</div>
						<h3 class="acex-error-title">${t}</h3>
						${s?`<p class="acex-error-description">${s}</p>`:""}
						${i?`
							<div class="acex-error-details">
								<code>${i}</code>
							</div>
						`:""}
						${n?`<p class="acex-error-help">${n}</p>`:""}
					</div>
				`;break;case"success":p=t||"Success";let f=Object.keys(o).length>0?`<div class="acex-success-details">
						${Object.entries(o).map(([A,L])=>`<p><strong>${A}:</strong> ${L}</p>`).join("")}
					</div>`:"";h=`
					<div class="acex-success-message">
						<div class="acex-success-icon">
							<svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<circle cx="12" cy="12" r="10" stroke="#28a745" stroke-width="2"/>
								<path d="M8 12L11 15L16 9" stroke="#28a745" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
						</div>
						<h3 class="acex-success-title">${t}</h3>
						${s?`<p class="acex-success-description">${s}</p>`:""}
						${f}
						${n?`<p class="acex-success-help">${n}</p>`:""}
					</div>
				`;break;case"warning":p=t||"Warning";let y=r.length>0?`<ul class="acex-warning-list">
						${r.map(A=>`<li>${A}</li>`).join("")}
					</ul>`:"";h=`
					<div class="acex-warning-message">
						<div class="acex-warning-icon">
							<svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M12 2L2 20h20L12 2z" stroke="#ffc107" stroke-width="2" stroke-linejoin="round"/>
								<path d="M12 9v4" stroke="#ffc107" stroke-width="2" stroke-linecap="round"/>
								<circle cx="12" cy="17" r="1" fill="#ffc107"/>
							</svg>
						</div>
						<h3 class="acex-warning-title">${t}</h3>
						${s?`<p class="acex-warning-description">${s}</p>`:""}
						${y}
					</div>
				`;break;case"info":p=t||"Information";let S=Object.keys(o).length>0?`<div class="acex-info-details">
						${Object.entries(o).map(([A,L])=>`<p><strong>${A}:</strong> ${L}</p>`).join("")}
					</div>`:"";h=`
					<div class="acex-info-message">
						<div class="acex-info-icon">
							<svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<circle cx="12" cy="12" r="10" stroke="#2196F3" stroke-width="2"/>
								<path d="M12 8v0" stroke="#2196F3" stroke-width="2" stroke-linecap="round"/>
								<path d="M12 12v4" stroke="#2196F3" stroke-width="2" stroke-linecap="round"/>
							</svg>
						</div>
						${t?`<h3 class="acex-info-title">${t}</h3>`:""}
						${s?`<p class="acex-info-description">${s}</p>`:""}
						${S}
					</div>
				`;break;default:p=t||"Alert",h=`<p>${s}</p>`}let g=[{text:c||m,class:"actus-btn-primary",onClick:f=>{u&&u(f),f.destroy()}}];return l.text&&g.unshift({text:l.text,class:l.className||"actus-btn-secondary",onClick:f=>{l.onClick&&l.onClick(f),f.destroy()}}),new d({title:p,content:h,size:"medium",className:"actus-modal-message",buttons:g}).open()}static error(e,t="",s="",a=null,i){return d.message("error",e,t,{errorMessage:s,helpText:a||"Please try again or contact support if the problem persists.",button2:i})}static success(e,t="",s={},a="",i=null){return d.message("success",e,t,{details:s,onClose:i,helpText:a})}static warning(e,t="",s=[]){return d.message("warning",e,t,{points:s})}static info(e,t="",s={}){return d.message("info",e,t,{details:s})}static alert(e,t="Alert"){return new d({title:t,content:e,size:"small",buttons:[{text:"OK",class:"actus-btn-primary",onClick:s=>s.destroy()}]}).open()}static confirm(e,t="Confirm",s=[],a="small"){s||(s=[]);let i="OK";return typeof s=="string"&&(i=s,s=[]),new Promise(o=>{let r=!1,n=new d({title:t,content:e||"",size:a,buttons:[...s,{text:"Cancel",class:"actus-btn",onClick:c=>{r=!0,o(!1),c.destroy()}},{text:i,class:"actus-btn-primary",onClick:c=>{r=!0,o(c),c.destroy()}}],onClose:()=>{r||o(!1),n.destroy()}}).open()})}static prompt(e,t="",s="Input"){return new Promise(a=>{let i=!1,o=`prompt-input-${Date.now()}`,r=new d({title:s,content:`
					<div class="actus-modal-prompt">
						<p>${e}</p>
						<input type="text" id="${o}" class="actus-input" value="${t}" autofocus />
					</div>
				`,size:"small",buttons:[{text:"Cancel",class:"actus-btn",onClick:n=>{i=!0,a(null),n.destroy()}},{text:"OK",class:"actus-btn-primary",onClick:n=>{let c=n.getBody().find(`#${o}`).val();i=!0,a(c),n.destroy()}}],onOpen:n=>{setTimeout(()=>{n.getBody().find(`#${o}`).focus().select()},150)},onClose:()=>{i||a(null),r.destroy()}}).open()})}},x=ke;var Ut=window.jQuery||jQuery,ye=window.acex_phpDATA||{};async function j(d){if(!d)return console.error("Name is required"),null;if(ye["product_"+d])return ye["product_"+d];try{let e=new FormData;e.append("action","acex_get_data"),e.append("name",d),e.append("nonce",acex_phpDATA?.nonce||"");let t=await fetch(acex_phpDATA.ajax_url,{method:"POST",body:e});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);let s=await t.json();return s.success?(ye["product_"+d]=s.data,ye["product_"+d]):(console.error("Error from server:",s.data?.message||"Unknown error"),[])}catch(e){throw console.error(`Error fetching data for '${d}':`,e),e}}async function xe(d){if(!d)return console.error("Option name is required"),null;try{let e=new FormData;e.append("action","acex_get_option"),e.append("name",d),e.append("nonce",acex_phpDATA?.nonce||"");let t=await fetch(acex_phpDATA.ajax_url,{method:"POST",body:e});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);let s=await t.json();return s.success?s.data.options:(console.error("Error from server:",s.data?.message||"Unknown error"),null)}catch(e){throw console.error(`Error loading option '${d}':`,e),e}}async function B(d,e){if(!d)return console.error("Option name is required"),null;try{let t=new FormData;t.append("action","acex_save_option"),t.append("name",d),t.append("value",JSON.stringify(e)),t.append("nonce",acex_phpDATA?.nonce||"");let s=await fetch(acex_phpDATA.ajax_url,{method:"POST",body:t});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);let a=await s.json();return a.success?a.data:(console.error("Error from server:",a.data?.message||"Unknown error",a.data),null)}catch(t){throw console.error(`Error saving option '${d}':`,t),t}}async function ot(d=3){if(!d)return null;try{let e=new FormData;e.append("action","acex_get_preview_products"),e.append("count",d),e.append("nonce",acex_phpDATA?.nonce||"");let t=await fetch(acex_phpDATA.ajax_url,{method:"POST",body:e});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);let s=await t.json();return s.success?s.data.products:(console.error("Error from server:",s.data?.message||"Unknown error"),null)}catch(e){throw console.error("Error fetching preview products:",e),e}}async function rt(d){if(!d||typeof d!="object")return null;try{let e=new FormData;e.append("action","acex_create_taxonomies"),e.append("data",JSON.stringify(d)),e.append("nonce",acex_phpDATA?.nonce||"");let t=await fetch(acex_phpDATA.ajax_url,{method:"POST",body:e});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);let s=await t.json();return s.success||console.error("Error from server:",s.data?.message||"Unknown error"),s.data}catch(e){throw console.error("Error saving full product data:",e),e}}async function nt(d,e={}){let{chunkSize:t=50,onProgress:s,_data:a}=e;if(!d||!Array.isArray(d)||d.length===0)return console.error("Products must be a non-empty array"),null;if(d.length<=t)return await st(d,a);let i=[];for(let r=0;r<d.length;r+=t)i.push(d.slice(r,r+t));let o={success:!0,total:d.length,successful:0,failed:0,warnings:0,created:0,updated:0,results:[]};for(let r=0;r<i.length;r++)try{let n=await st(i[r],a);if(n&&n.success){o.successful+=n.successful,o.failed+=n.failed,o.created+=n.created,o.updated+=n.updated,o.results.push(...n.results);let c=n.results.filter(l=>l.warnings&&l.warnings.length>0).length;o.warnings+=c}else o.failed+=i[r].length;if(s){let c=(r+1)*t;s(Math.min(c,d.length),d.length,n)}}catch(n){console.error(`Error processing chunk ${r+1}:`,n),o.failed+=i[r].length}return o}async function st(d,e){try{let t=new FormData;t.append("action","acex_save_multiple_products"),t.append("products_data",JSON.stringify(d)),t.append("_data",JSON.stringify(e)),t.append("nonce",acex_phpDATA?.nonce||"");let s=await fetch(acex_phpDATA.ajax_url,{method:"POST",body:t});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);let a=await s.json();if(a.success){let i=a.data.summary;return{success:!0,total:i.total,successful:i.successful,failed:i.failed,created:i.created,updated:i.updated,results:a.data.results}}else return console.error("Error from server:",a.data?.message||"Unknown error"),{success:!1,total:d.length,successful:0,failed:d.length,results:[{error:!0,message:a.data?.message||"Unknown error"}]}}catch(t){throw console.error("Error saving batch:",t),t}}async function re(d,e=!1,t=20,s=1,a=!1){if(!d||typeof d!="object")return console.error("Query must be an object"),null;let i=JSON.parse(JSON.stringify(d));delete i.description;try{a||(a="");let o=new FormData;o.append("action","acex_query"),o.append("limit",t),o.append("page",s),o.append("images",a),o.append("query",JSON.stringify(i)),o.append("nonce",acex_phpDATA?.nonce||""),e&&o.append("count",e);let r=await fetch(acex_phpDATA.ajax_url,{method:"POST",body:o});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);let n=await r.json();return n.success?e?n.data.count:n.data:(console.log("data",n),console.error("Error from server:",n.data?.message||"Unknown error"),null)}catch(o){throw console.error("Error getting product count:",o),o}}async function lt(d,e){try{let t=new FormData;t.append("action","acex_validate_import"),t.append("products",JSON.stringify(d)),t.append("keys",e),t.append("nonce",acex_phpDATA?.nonce||"");let s=await fetch(acex_phpDATA.ajax_url,{method:"POST",body:t});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);let a=await s.json();return a.success?a.data||[]:(console.error("Error from server:",a.data?.message||"Unknown error"),null)}catch(t){throw console.error("Error validating products:",t),t}}var at=[];function se(d,...e){let t=["check","export"],s=it(!0);t.includes(d)||(console.groupCollapsed("%c"+d.padStart(10),"background: darkorange; color: white; padding: 2px 4px;",...e),s=it(),console.groupEnd()),at.push(["["+d+"]",...e,...s]),window.LOGS=at}function it(d=!1){let t=new Error().stack.split(`
`),s=[],a="";return t.slice(3).forEach((o,r)=>{if(o.includes("load-scripts.php")||o.includes("jquery.min.js"))return;let n=o.match(/at\s+(.+)\s+\((.+):(\d+):(\d+)\)/);if(n){let[c,l,u,h,p]=n,m=u.split("actus-excel-for-woo").pop();l=l.replace("HTMLDivElement.",""),d||console.log(`${l} ${u}:${h}`),l=l.padEnd(30,"."),s.push(l+`${m}:${h}`),a+=l+`${m}:${h}
`}}),s}var H=window.jQuery||jQuery,ae=window.acex_phpDATA||{},Wt=ae.strings||{},{__:ve}=wp.i18n,be="acex_license_check",Dt=720*60*1e3,Et=900*1e3,Ce=class{constructor(){this.key=null,this.status=null,this.expires=null,this.email=null,this.end=null,this.activations=null,this.isInitialized=!1,this.free={},this.setFree(),this.$mainContainer=H(".acex-main"),this.$bodyContainer=null,this.$bodyTitle=null,this.$bodyNote=null}async init(){this.isInitialized&&this.cleanup();let e=await xe("acex-license")||{};e&&e.key&&(this.key=e.key,this.status=e.status,this.email=e.email,this.expires=e.expires,this.plan=e.plan,this.end=e.end,this.activations=e.activations),this.isInitialized=!0,await this.check(),H("body").off("click.licenseManager",".acex-premium"),H("body").on("click.licenseManager",".acex-premium",async t=>{this.status==="active"||(t.stopPropagation(),t.preventDefault(),await x.confirm(ve("This is a premium feature. Upgrade to premium to use it?","actus-excel-for-woo"),ve("Premium Feature","actus-excel-for-woo"),[{text:"Upgrade Now",class:"actus-btn-primary",onClick:a=>{a.destroy(),window.open("https://awexcel.actusanima.com/","_blank")}},{class:"actus-modal-flex-1"}]))})}start(){this.$mainContainer.empty(),this.licenseBody(),this.license(),setTimeout(()=>{this.showStatus(),this.licenseEvents()},10)}cleanup(){this.$bodyContainer=null,this.$bodyHeader=null,this.$bodyTitle=null,this.$bodyNote=null,this.isInitialized=!1}licenseBody(){this.$bodyContainer=H('<div class="acex-license-body">').appendTo(this.$mainContainer),this.$bodyHeader=H('<div class="acex-header-flex">').appendTo(this.$bodyContainer),this.$bodyTitle=H("<h2>").appendTo(this.$bodyHeader),this.$bodyNote=H("<p>").appendTo(this.$bodyHeader),this.$bodyContainer=H('<div class="acex-license-body-container">').appendTo(this.$bodyContainer);let e=`
			<div class="actus-section">
			<div class="actus-form-group">
				<label class="actus-label" for="license_key">License Key</label>
				<div class="actus-flex">
					<input type="text"
							class="actus-input"
							id="license_key"
							name="license_key"
							value="${this.key||""}"
							autocomplete="off"
							placeholder="enter your license key">
					<div class="actus-chip acex-license-status"></div>
					<button class="actus-btn-big acex-test-button">Activate</button>
					<button class="actus-btn-big acex-deactivate-button">Deactivate</button>
				</div>

				<small class="actus-form-help"></small>
				<br>
				<a href="https://copyspell.ai/#home-pricing" target="_blank" rel="noopener" class="actus-btn actus-btn-outline acex-info-btn">Get License Key</a>
			</div>
			</div>`;setTimeout(()=>{this.$bodyContainer.html(e),this.$status=this.$bodyContainer.find(".acex-license-status"),this.$helpText=this.$bodyContainer.find(".actus-form-help"),this.$testButton=this.$bodyContainer.find(".acex-test-button"),this.$deactivateButton=this.$bodyContainer.find(".acex-deactivate-button"),this.$infoButton=this.$bodyContainer.find(".acex-info-btn"),this.$input=this.$bodyContainer.find("#license_key")},0)}license(){this.$bodyTitle.text("License Management"),this.$bodyNote.text("Manage your license key and activation status here."),this.$bodyContainer.empty()}licenseEvents(){this.$input.on("input",()=>{this.$deactivateButton.hide();let e=this.$input.val().trim();e?(this.$testButton.show(),this.$status.hide()):(this.$testButton.hide(),this.$status.show(),this.status="no key",this.showStatus()),this.key=e}),this.$testButton.on("click",async e=>{e.preventDefault(),this.$testButton.prop("disabled",!0),this.$testButton.html(ae.SVG.loader),this.clearCache();let t=this.$input.val().trim();t&&(await this.validate(t),this.$status.show(),this.$testButton.text("Activate"),this.$testButton.prop("disabled",!1),this.$testButton.hide()),this.showStatus()}),this.$deactivateButton.on("click",async e=>{if(e.preventDefault(),!confirm("Are you sure you want to deactivate the license key?"))return;this.$deactivateButton.prop("disabled",!0),this.$deactivateButton.html(ae.SVG.loader),this.clearCache();let s=this.$input.val().trim();this.$input.val(""),this.key="",s&&(await this.deactivate(s),this.$status.show(),this.$deactivateButton.text("Deactivate"),this.$deactivateButton.prop("disabled",!1),this.$deactivateButton.hide()),this.showStatus()})}async showStatus(e){if(!this.$input||!this.$input.length)return;this.$input.val(this.key||""),e=e||this.status||"no key",this.status=e;let t=e,s="",a="";if(this.expires){let i=new Date(this.expires);if(isNaN(i))a=this.expires;else{let o=String(i.getDate()).padStart(2,"0"),r=String(i.getMonth()+1).padStart(2,"0"),n=i.getFullYear();a=`${o}/${r}/${n}`}}switch(this.$infoButton.hide(),this.$deactivateButton.hide(),e){case"active":if(t="Licensed to <b>"+this.email+"</b><br>",s="actus-chip-green",this.end){let i=new Date(this.end*1e3);if(isNaN(i))t+="Expires <b>"+this.end+"</b><br>";else{let o=String(i.getDate()).padStart(2,"0"),r=String(i.getMonth()+1).padStart(2,"0"),n=i.getFullYear();t+=`Expires <b>${o}/${r}/${n}</b><br>`}t+=`<br><a href="https://billing.stripe.com/p/login/7sY14mfvofQ86Gbgtf2go00?prefilled_email=${this.email}" target="_blank" rel="noopener" class="aai-btn-2 aai-btn-2-primary">Manage Subscription</a>`}this.activations&&(t+="Activations <b>"+this.activations+"</b>");break;case"inactive":t="Inactive License Key",s="actus-chip-red";break;case"expired":t="Expired License Key",t+=`<br><br><a href="https://billing.stripe.com/p/login/7sY14mfvofQ86Gbgtf2go00?prefilled_email=${this.email}" target="_blank" rel="noopener" class="aai-btn-2 aai-btn-2-primary">Renew Subscription</a>`,s="actus-chip-red";break;case"invalid":t="Invalid License Key",s="actus-chip-red";break;case"deactivated":t="Deactivated License Key",s="actus-chip-orange";break;case"revoked":t="Revoked License Key",s="actus-chip-red";break;case"no key":default:t="No License Key",s="actus-chip-purple";break}e!="active"&&e!="expired"?this.$infoButton.show():e=="active"&&this.$deactivateButton.show(),e=="deactivated"&&this.key&&this.$testButton.show(),this.$helpText.html(t),this.$status.removeClass().addClass(`acex-license-status actus-chip ${s}`).html(e.replace(/\s+/g," "))}clearCache(){localStorage.removeItem(be)}async check(e=!1){this.isInitialized||await new Promise(s=>{let a=()=>{if(this.isInitialized)return s();setTimeout(a,50)};a()});let t;if(!this.key)H(".acex-admin").removeClass("acex-is-premium"),H(".acex-admin").addClass("acex-is-lite");else{let s=localStorage.getItem(be)||"{}";if(se("check",s),s){s=JSON.parse(s);let{timestamp:a,data:i,status:o}=s;o&&Date.now()-a<Dt&&(t=i)}if(typeof t>"u")if(s=s||{},se("check",this.status),this.status!=="active"&&Date.now()-(s.timestamp||0)<Et)H(".acex-admin").removeClass("acex-is-premium"),H(".acex-admin").addClass("acex-is-lite");else{let a=await xe("acex-license")||{};t=await this.validate(a?.key),a=await xe("acex-license")||{},se("check",a),localStorage.setItem(be,JSON.stringify({timestamp:Date.now(),status:a.status,data:t}))}H(".acex-admin").removeClass("acex-is-lite acex-is-premium"),t?H(".acex-admin").addClass("acex-is-premium"):H(".acex-admin").addClass("acex-is-lite")}if(!t&&e){let s=ve("Upgrade to the Premium version to unlock all features.","actus-excel-for-woo");typeof e=="string"&&(s=e),await x.confirm(s,ve("Upgrade to Premium","actus-excel-for-woo"),"Upgrade Now")&&window.open("https://awexcel.actusanima.com/","_blank");return}return t}async validate(e){if(e=e||this.key,!e)return!1;this.key=e;let t={};try{let a=await fetch(ae.license_api_url+"/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({licenseKey:e,siteUrl:ae.siteUrl,pluginId:"actus-excel-for-woo"})});t=await a.json(),this.email=t.email||"",this.expires=t.expires||"",this.activations="",this.isSiteActivated=t.isSiteActivated||!1,this.plan=t.plan||"",this.end=t.end||null,a.ok&&t.success?(this.status=t.status,t.maxActivations&&t.maxActivations>1&&(this.activations=this.activationsCount+" / "+this.maxActivations)):(this.status="inactive",t.code=="NOT_FOUND"&&(this.status="invalid"),t.code=="EXPIRED"&&(this.status="expired"),t.code=="DEACTIVATED"&&(this.status="deactivated"),t.code=="REVOKED"&&(this.status="inactive"),t.code=="MAX_ACTIVATIONS"&&(this.status="max activations reached"),t.code=="EXPIRED_TRIAL"&&(this.status="expired trial"))}catch(a){console.error("Network or API error:",a),this.status="inactive"}finally{await B("acex-license",{key:e,status:this.status,email:this.email,expires:this.expires,activations:this.activations,plan:this.plan,end:this.end}),await B("acex-license-status",{status:this.status,expires:this.expires,activationsCount:t.activationsCount,maxActivations:t.maxActivations}),this.showStatus()}let s=!1;return this.status=="active"&&(s=!0),localStorage.setItem(be,JSON.stringify({timestamp:Date.now(),data:s})),s}async deactivate(e){if(e=e||this.key,!e)return!1;this.key=e;let t={};try{t=await(await fetch(ae.license_api_url+"/license/deactivate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({licenseKey:e,siteUrl:ae.siteUrl,pluginId:"actus-excel-for-woo"})})).json(),this.key="",this.status="no key",this.activations=t.activationsCount+" / "+t.maxActivations,this.showStatus(),await B("acex-license",{key:this.key,status:this.status,email:this.email,expires:this.expires,activations:this.activations,plan:this.plan,end:this.end}),await B("acex-license-status",{status:"no key",expires:t.expires||"",activationsCount:t.activationsCount,maxActivations:t.maxActivations})}catch(s){console.error("Network or API error:",s)}return t}setFree(){return this.free.groups=["core","pricing","stock","shipping","attributes"],this.free.props=["id","name","slug","status","type","description","short_description","date_created","price","regular_price","sale_price","sku","manage_stock","stock_quantity","stock_status","weight","length","width","height","attributes","attribute_values","parent_id"],this.free.filters=["status","type","created","modified","categories","price"],this.free}},w=new Ce;var I=window.jQuery||jQuery,Te=window.acex_phpDATA||{},Zt=Te.strings||{},Se=class{constructor(){this.$container=null,this.template={columns:[]},this.previewProducts=[],this.mode="template",this.dragHandlers=null}events(){}cleanup(){this.removeDragHandlers(),this.$container=null,this.previewProducts=[],this.template={columns:[]}}setContainer(e){return this.$container=e,this}setPreviewProducts(e,t="products"){return this.previewProducts=e||[],this.mode=t,this}async fetchPreviewProducts(){this.previewProducts.length||(this.previewProducts=await ot(10)),!(this.previewProducts.length>=10)&&console.log("this.previewProducts",this.previewProducts)}async create(e,t){if(this.template=e||{columns:[]},t&&(this.previewProducts=t,this.mode="products"),!this.$container||(this.dragHandlers&&this.removeDragHandlers(),this.$container.empty(),!this.template.columns.length))return;this.mode=="template"&&(this.$container.html(`<div class="actus-loader">${Te.SVG.loader}</div>`),await this.fetchPreviewProducts()),this.$container.empty(),this.dragHandlers&&this.removeDragHandlers(),I("<h3>").text("Preview").appendTo(this.$container);let s=I('<table class="acex-preview-table">').appendTo(this.$container),a=I("<thead>").appendTo(s),i=I("<thead>").appendTo(s),o=I("<tbody>").appendTo(s),r=I("<tr>").appendTo(a),n=I("<tr>").appendTo(i);this.template.columns.forEach((u,h)=>{let p=I("<th>").text(u.header).attr("draggable",!0).attr("data-column-index",h).addClass("draggable-header").appendTo(r)}),this.template.columns.forEach(u=>{I("<th>").text(u.key).appendTo(n)}),this.makeDraggable(r,s);let c=0,l=10;this.previewProducts.forEach(u=>{let h=I("<tr>").appendTo(o);if(this.template.columns.forEach(p=>{let m=u[p.key]!==void 0?u[p.key]:"";if(!m&&u.meta_data&&(m=u.meta_data[p.key]!==void 0?u.meta_data[p.key]:""),!m){let g="_"+p.key;g&&g!==p.key&&(m=u[g]!==void 0?u[g]:""),!m&&u.meta_data&&(m=u.meta_data[g]!==void 0?u.meta_data[g]:"")}Array.isArray(m)&&(typeof m[0]=="object"&&m[0]!==null&&!Object.keys(Te.data_taxonomies).includes(p.key)?m=JSON.stringify(m,null,2):(m.length&&typeof m[0]=="object"&&m[0]!==null&&(m=m.map(g=>g.name||g.slug||g.id||"").filter(Boolean)),m=m.join(`
`))),typeof m=="object"&&m!==null&&(m=JSON.stringify(m,null,2)),p.key.includes("slug")&&(m=decodeURIComponent(m||"")),typeof m=="string"&&/<\/?[a-z][\s\S]*>/i.test(m)&&(m=I("<div>").text(m).html()),m=`<div class="acex-field-value">${m}</div>`,I("<td>").html(m).appendTo(h)}),c++,c>=l)return!1})}removeDragHandlers(){if(!this.dragHandlers||!this.dragHandlers.$headers)return;let e=this.dragHandlers.$headers;e.off("dragstart dragover dragenter dragleave drop dragend"),e.off(".acex-columns"),this.dragHandlers=null}makeDraggable(e,t){let s=null,a=null,i=e.find("th[draggable]");this.dragHandlers={$headers:i},i.on("dragstart.acex-columns",o=>{a=o.currentTarget,s=parseInt(I(a).attr("data-column-index")),I(a).addClass("dragging"),o.originalEvent.dataTransfer.effectAllowed="move",o.originalEvent.dataTransfer.setData("text/html",a.innerHTML)}),i.on("dragover.acex-columns",o=>{o.preventDefault(),o.originalEvent.dataTransfer.dropEffect="move";let r=I(o.currentTarget);return a!==o.currentTarget&&r.addClass("drag-over"),!1}),i.on("dragenter.acex-columns",o=>{let r=I(o.currentTarget);a!==o.currentTarget&&r.addClass("drag-over")}),i.on("dragleave.acex-columns",o=>{I(o.currentTarget).removeClass("drag-over")}),i.on("drop.acex-columns",o=>{o.stopPropagation(),o.preventDefault();let r=I(o.currentTarget);r.removeClass("drag-over");let n=parseInt(r.attr("data-column-index"));return s!==null&&s!==n&&(this.reorderColumns(s,n),this.create(this.template)),!1}),i.on("dragend.acex-columns",o=>{I(o.currentTarget).removeClass("dragging"),i.removeClass("drag-over"),s=null,a=null})}reorderColumns(e,t){let[s]=this.template.columns.splice(e,1);this.template.columns.splice(t,0,s),console.log("Columns reordered:",this.template.columns.map(a=>a.header)),this.$container&&this.$container.trigger("columnsReordered",[this.template.columns])}},V=new Se;var Pt=[{query_name:"\u{1F4E6} All Published",status:["publish"],description:"All published products in the store",_system:!0},{query_name:"\u{1F195} Recently Added",status:["publish"],date_from:new Date(Date.now()-2592e6).toISOString().split("T")[0],description:"Products added in the last 30 days",_system:!0},{query_name:"\u{1F504} Recently Updated",date_modified_from:new Date(Date.now()-6048e5).toISOString().split("T")[0],description:"Products modified in the last 7 days",_system:!0},{query_name:"\u{1F570}\uFE0F Old Products",date_created_to:new Date(Date.now()-31536e6).toISOString().split("T")[0],description:"Products older than 1 year",_system:!0},{query_name:"\u{1F4A4} Stale Products",date_modified_to:new Date(Date.now()-15552e6).toISOString().split("T")[0],description:"Products not updated in 6+ months",_system:!0},{query_name:"\u{1F6D2} Overstocked",manage_stock:"yes",min_stock:100,description:"Products with more than 100 units in stock",_system:!0,p:!0},{query_name:"\u{1F4C9} Low Stock Alert",status:["publish"],stock_status:["instock"],manage_stock:"yes",max_stock:10,description:"Products with low stock (10 or less)",_system:!0,p:!0},{query_name:"\u26A0\uFE0F Out of Stock",status:["publish"],stock_status:["outofstock"],description:"Products currently out of stock",_system:!0,p:!0},{query_name:"\u{1F4B0} On Sale",status:["publish"],on_sale:!0,description:"Products currently on sale",_system:!0,p:!0},{query_name:"\u23F3 Expired Sales",date_on_sale_to:new Date().toISOString().split("T")[0],description:"Products with sale dates that have ended",_system:!0,p:!0},{query_name:"\u2B50 Featured",status:["publish"],featured:!0,description:"Products marked as featured",_system:!0},{query_name:"\u2B50 With Reviews",template:"products_with_reviews",description:"Products that have customer reviews",_system:!0},{query_name:"\u2B50 High Rated",template:"high_rated_products",description:"Products with an average rating of 4.0 or higher",_system:!0},{query_name:"\u2696\uFE0F Heavy Products",template:"heavy_products",description:"Products with a weight greater than 50kg. Important for shipping considerations.",_system:!0},{query_name:"\u2757 Incomplete Products",template:"incomplete_products",description:"Products missing critical data (no price, image, or SKU).",_system:!0,p:!0},{query_name:"\u274C Without Price",template:"products_no_price",description:"Products missing a regular price.",_system:!0,p:!0},{query_name:"\u274C Without Categories",template:"uncategorized_products",description:"Products not assigned to any category. Important for organization and navigation.",_system:!0,p:!0},{query_name:"\u274C Without Featured Image",template:"no_featured_image",description:"Products missing a featured image. Important for visual appeal.",_system:!0,p:!0},{query_name:"\u274C Without Description",template:"no_description",description:"Products missing a description. Important for SEO and conversions.",_system:!0},{query_name:"\u274C Without Weight",template:"no_weight",description:"Products missing a weight attribute. Can affect shipping calculations.",_system:!0},{query_name:"\u274C Without Dimensions",template:"no_dimensions",description:"Products missing dimensions (length, width, height). Important for shipping and display.",_system:!0}],Ae=Pt;var D=window.jQuery||jQuery,we=window.acex_phpDATA||{},De,Ee=class{constructor(e,t,s){if(this.$container=null,this.$input=e||D(),this.$target=t||D(),this.name=s||"",this.$list=D(),this.listCurrent=0,this.result=[],this.selected=[],this.callback=null,this.$input.length){this.$container=this.$input.parent(),this.$input.attr("autocomplete","off"),this.name=this.name||this.$input.attr("name")||this.$container.attr("name")||"search_product";let a=this.$container.css("position");["relative","absolute","fixed"].includes(a)||this.$container.css("position","relative"),this.$hidden=D('<input type="hidden" />').attr("name",this.name).insertBefore(this.$input),this.events()}De=this}events(){this.$input.on("input",this.search.bind(this)),this.$input.on("keydown",this.preventEnterOnSearch.bind(this)),this.$input.on("keyup",this.listKeyEvents.bind(this))}setValue(e){this.selected=e||[],this.$hidden.val(JSON.stringify(this.selected)),this.populateTarget()}search(e){let t=D.trim(D(e.target).val());t.length>2?(this.ajax&&this.ajax.abort(),this.timeout&&clearTimeout(this.timeout),this.listInit(e),this.timeout=setTimeout(s=>{this.ajax=D.post(we.ajax_url,{_ajax_nonce:we.nonce,action:"acex_search_product",search:t},function(a){De.result=a.data,De.resultList(),console.log("result",a.data)})},400,e)):this.$list.length&&(this.$list.remove(),this.$list=D())}listInit(e){console.log("listInit",this.$list),!(this.$list&&this.$list.length)&&(this.$list=D('<div class="acex-results">').html(we.SVG.loader).insertAfter(e.target),this.$list.css({position:"absolute",zIndex:9999,width:this.$input.outerWidth(),top:this.$input.offset().top+this.$input.outerHeight(),left:this.$input.offset().left}).appendTo("body"),this.updateListPosition=()=>{this.$list.length&&this.$list.css({top:this.$input.offset().top+this.$input.outerHeight(),left:this.$input.offset().left,width:this.$input.width()})},D(window).off("scroll.acex-search resize.acex-search"),D(window).on("scroll.acex-search resize.acex-search",this.updateListPosition))}resultList(){this.$list.empty();let e=this.selected.map(t=>t[0]);if(this.result=this.result.filter(t=>!e.includes(String(t.ID))),!this.result.length){this.$list.remove(),this.$list=D();return}this.result.forEach(t=>{D('<div class="acex-row">').attr("data-id",t.ID).attr("data-title",t.post_title).attr("data-sku",t.sku).html(t.sku+" - "+t.post_title).appendTo(this.$list).click(this.listSelect.bind(this))}),this.listCurrent=0,this.listActive(),D("body").off("click.acex-search"),D("body").on("click.acex-search",t=>{D(t.target).closest(".acex-results").length||this.$list?.length&&(this.$list.remove(),this.$list=D())})}listKeyEvents(e){this.$list.length&&(this.$list.children().length<=1||(e.keyCode==38&&(this.listCurrent--,this.listCurrent<0&&(this.listCurrent=this.$list.children().length),this.listActive()),e.keyCode==40&&(this.listCurrent++,this.listCurrent>this.$list.children().length&&(this.listCurrent=0),this.listActive()),e.keyCode==13&&(e.preventDefault(),e.stopPropagation(),this.listSelect())))}listActive(){this.$list.children().removeClass("actus-active"),this.$list.children().eq(this.listCurrent).addClass("actus-active")}listSelect(e){let t=this.$list.children().eq(this.listCurrent);e&&(t=D(e.target));let s=t.attr("data-id"),a=t.attr("data-sku"),i=t.attr("data-title");this.$list.remove(),this.$list=D(),this.selected.push([s,t.text()]),this.$hidden.val(JSON.stringify(this.selected)),this.onChange(null,this.selected),this.populateTarget()}onChange(e,t){e&&(this.callback=e),t&&this.callback(t)}removeItem(e){let t=D(e.target).closest(".acex-row"),s=t.attr("data-id");t.remove(),this.selected.forEach((a,i)=>{a[0]==s&&this.selected.splice(i,1)}),this.$hidden.val(JSON.stringify(this.selected)),this.onChange(null,this.selected),this.populateTarget()}preventEnterOnSearch(e){e.keyCode==13&&(e.preventDefault(),e.stopPropagation())}populateTarget(){this.$target?.length&&(this.$target.empty(),this.selected.forEach(e=>{let t=D('<div class="acex-row actus-tag">').attr("data-id",e[0]).html(e[1]).appendTo(this.$target);D(we.SVG.times).appendTo(t).click(this.removeItem.bind(this))}))}},ct=Ee;var T=window.jQuery||jQuery,dt=window.acex_phpDATA||{},as=dt.strings||{};function Pe(d,e){let t=T(`
		<div class="acex-filter acex-product-filters actus-open">
			<h3>Products<span>${dt.SVG.caret}</span></h3>
			<div class="acex-filter-body">

				<div class="acex-filter-status actus-flex">
					<label class="actus-label">Status</label>
					<label><input type="checkbox" class="acex-status-checkbox" value="publish" ${d.status?.includes("publish")?"checked":""} /> Published</label>
					<label><input type="checkbox" class="acex-status-checkbox" value="draft" ${d.status?.includes("draft")?"checked":""} /> Draft</label>
					<label><input type="checkbox" class="acex-status-checkbox" value="pending" ${d.status?.includes("pending")?"checked":""} /> Pending</label>
					<label><input type="checkbox" class="acex-status-checkbox" value="private" ${d.status?.includes("private")?"checked":""} /> Private</label>
				</div>

				<div class="acex-filter-type actus-flex">
					<label class="actus-label">Type</label>
					<label><input type="checkbox" class="acex-type-checkbox" value="simple" ${d.product_type?.includes("simple")?"checked":""} /> Simple</label>
					<label><input type="checkbox" class="acex-type-checkbox" value="variable" ${d.product_type?.includes("variable")?"checked":""} /> Variable</label>
					<label><input type="checkbox" class="acex-type-checkbox" value="grouped" ${d.product_type?.includes("grouped")?"checked":""} /> Grouped</label>
					<label><input type="checkbox" class="acex-type-checkbox" value="external" ${d.product_type?.includes("external")?"checked":""} /> External</label>
				</div>

				<div class="acex-filter-row acex-filter-created actus-flex">
					<label class="actus-label">Created</label>
					<div class="actus-form-group actus-flex">
						<label class="actus-label actus-small" for="date_from">From:</label>
						<input class="actus-input actus-small" type="date" id="date_from" class="acex-on-sale-date-input" value="${d.date_from||""}" />
					</div>
					<div class="actus-form-group actus-flex">
						<label class="actus-label actus-small" for="date_to">To:</label>
						<input class="actus-input actus-small" type="date" id="date_to" class="acex-on-sale-date-input" value="${d.date_to||""}" />
					</div>
					<button class="actus-btn actus-btn-secondary acex-clear-created-date">clear</button>
				</div>

				<div class="acex-filter-row acex-filter-modified actus-flex">
					<label class="actus-label">Modified</label>
					<div class="actus-form-group actus-flex">
						<label class="actus-label actus-small" for="modified_from">From:</label>
						<input class="actus-input actus-small" type="date" id="modified_from" class="acex-on-sale-date-input" value="${d.modified_from||""}" />
					</div>
					<div class="actus-form-group actus-flex">
						<label class="actus-label actus-small" for="modified_to">To:</label>
						<input class="actus-input actus-small" type="date" id="modified_to" class="acex-on-sale-date-input" value="${d.modified_to||""}" />
					</div>
					<button class="actus-btn actus-btn-secondary acex-clear-modified-date">clear</button>
				</div>

				<div class="acex-filter-row acex-filter-author actus-flex acex-premium">
					<label class="actus-label">Author IDs</label>
					<input class="actus-input actus-small" type="text" id="author_ids" class="acex-ids-input" value="${d.author_ids||""}" />
				</div>

				<div class="acex-filter-row acex-filter-ids actus-flex acex-premium">
					<label class="actus-label">Product IDs</label>
					<input class="actus-input actus-small" type="text" id="ids" class="acex-ids-input" value="${d.ids||""}" />
				</div>
				<div class="acex-note acex-premium">If product IDs or Specific Products are entered, all other filters will be ignored.</div>

				<div class="acex-filter-row acex-specific-products actus-flex acex-premium">
					<div class="acex-specific-products-target"></div>
					<label class="actus-label">Specific Products</label>
					<input class="actus-input actus-small acex-search-products" type="search" />
				</div>

			</div>
		</div>
	`);e.append(t);let s=new ct(e.find(".acex-search-products"),T(".acex-specific-products-target"));s.setValue(d.specific_products||""),s.onChange(a=>{console.log("Specific Products changed:",a),d.specific_products=a,T("body").trigger("acex::filter-changed-query",[d,T()])}),T("body").off("change.acex-select-products",".acex-product-filters .acex-status-checkbox"),T("body").on("change.acex-select-products",".acex-product-filters .acex-status-checkbox",a=>{let i=T(a.currentTarget),o=i.val();T("body").trigger("acex::filter-changed",["status",o,i])}),T("body").off("change.acex-select-products",".acex-product-filters .acex-type-checkbox"),T("body").on("change.acex-select-products",".acex-product-filters .acex-type-checkbox",a=>{let i=T(a.currentTarget),o=i.val();T("body").trigger("acex::filter-changed",["product_type",o,i])}),T("body").off("change.acex-select-products",'.acex-product-filters input[type="date"]'),T("body").on("change.acex-select-products",'.acex-product-filters input[type="date"]',a=>{let i=T(a.currentTarget),o=i.val(),r=i.attr("id");T("body").trigger("acex::filter-changed",[r,o,i])}),T("body").off("click.acex-select-products",".acex-product-filters .actus-btn-secondary"),T("body").on("click.acex-select-products",".acex-product-filters .actus-btn-secondary",a=>{a.preventDefault();let i=T(a.currentTarget),o,r,n=i.siblings(".actus-label").text().toLowerCase();n.includes("created")?(o="date_from",r="date_to"):n.includes("modified")&&(o="modified_from",r="modified_to"),T("body").trigger("acex::filter-clear-date",[o,r,i])}),T("body").off("change.acex-select-products",'.acex-product-filters input[type="text"]'),T("body").on("change.acex-select-products",'.acex-product-filters input[type="text"]',a=>{let i=T(a.currentTarget),o=i.val(),r=i.attr("id");T("body").trigger("acex::filter-changed",[r,o,i])})}var ue=window.jQuery||jQuery,ut=window.acex_phpDATA||{},os=ut.strings||{};function Ie(d,e,t){let s=(n,c=0,l=new Set)=>{let u=[];for(let h of n){if(l.has(h.term_id))continue;let p=h.parent!==void 0?h.parent:h.category_parent;if(p==c){l.add(h.term_id);let m={id:h.term_id,name:h.name,slug:h.slug,parent:p,count:h.count||0,children:[]};m.children=s(n,h.term_id,l),u.push(m)}}return u},a=n=>n.length?`<ul>
			${n.map(c=>{let l=d.categories?.includes(String(c.slug))?"checked":"",u="acex-no-children";return c.children&&c.children.length&&(u="acex-has-children"),`
				<li class="${u}">
					<label>
						<input type="checkbox" value="${c.slug}" class="acex-category-checkbox" ${l} />
						${c.name}
					</label>
					${a(c.children)}
				</li>
			`}).join("")}
		</ul>`:"",i=s(t),o=!!(d.categories&&d.categories.length>0),r=ue(`
		<div class="acex-filter ${o?"actus-open":""}">
			<h3>Categories<span>${ut.SVG.caret}</span></h3>
			<div class="acex-filter-body">
				<div class="acex-category-tree">
					${a(i)}
				</div>
			</div>
		</div>
	`);e.append(r),ue("body").off("change.acex-select-products",".acex-category-checkbox"),ue("body").on("change.acex-select-products",".acex-category-checkbox",n=>{let c=ue(n.currentTarget),l=decodeURIComponent(c.val());ue("body").trigger("acex::filter-changed",["categories",l,c])})}var pe=window.jQuery||jQuery,pt=window.acex_phpDATA||{},ns=pt.strings||{};function Fe(d,e,t){let s=!!(d.tags&&d.tags.length>0),a=pe(`
		<div class="acex-filter acex-premium ${s?"actus-open":""}">
			<h3>Tags<span>${pt.SVG.caret}</span></h3>
			<div class="acex-filter-body">
				<div class="acex-filter-tags">
					${t.map(i=>`<div class="actus-tag ${d.tags?.includes(String(i.slug))?"actus-selected":""}" data-id="${i.term_id}" data-slug="${i.slug}">${i.name}</div>`).join("")}
				</div>
			</div>
		</div>
	`);e.append(a),pe("body").off("click.acex-select-products",".acex-filter-tags .actus-tag"),pe("body").on("click.acex-select-products",".acex-filter-tags .actus-tag",i=>{let o=pe(i.currentTarget),r=decodeURIComponent(o.attr("data-slug"));pe("body").trigger("acex::filter-changed",["tags",r,o])})}var he=window.jQuery||jQuery,Oe=window.acex_phpDATA||{},ds=Oe.strings||{};async function je(d,e,t){let s="",a=!1;await j("attributes"),t=Oe.product_attributes||[],t.forEach(o=>{let r="";if(o.terms&&o.terms.length){let n=o.attribute_name;r=`
				<div class="acex-attribute-terms">
					${o.terms.map(c=>{let l=d.attributes?.[n]?.includes(String(c.term_id))?"actus-selected":"";return l&&(a=!0),`<div class="actus-tag actus-small acex-attribute-term ${l}" data-id="${c.term_id}">${c.name}</div>`}).join("")}
				</div>
			`}s+=`
			<div class="acex-attribute" data-id="${o.attribute_id}">
				<label>${o.attribute_label}</label>
				${r}
			</div>
		`});let i=he(`
		<div class="acex-filter acex-premium ${a?"actus-open":""}">
			<h3>Attributes<span>${Oe.SVG.caret}</span></h3>
			<div class="acex-filter-body">
				<div class="acex-filter-attributes">
					${s}
				</div>
			</div>
		</div>
	`);e.append(i),he("body").off("click.acex-select-products",".acex-attribute-term"),he("body").on("click.acex-select-products",".acex-attribute-term",o=>{let r=he(o.currentTarget),n=r.attr("data-id"),l=r.closest(".acex-attribute").find("label").text();r.hasClass("actus-selected")?(r.removeClass("actus-selected"),d.attributes=d.attributes||{},d.attributes[l]=d.attributes[l].filter(u=>u!==n),d.attributes[l].length==0&&delete d.attributes[l]):(r.addClass("actus-selected"),d.attributes=d.attributes||{},d.attributes[l]=d.attributes[l]||[],d.attributes[l].push(n)),d.attributes&&Object.keys(d.attributes).length==0&&delete d.attributes,he("body").trigger("acex::filter-changed-query",[d,$el])})}var F=window.jQuery||jQuery,ht=window.acex_phpDATA||{},ps=ht.strings||{};function Le(d,e){let t=!!(d.min_price||d.max_price||d.min_sale_price||d.max_sale_price||d.date_on_sale_from||d.date_on_sale_to),s=F(`
		<div class="acex-filter actus-price-filters ${t?"actus-open":""}">
			<h3>Price<span>${ht.SVG.caret}</span></h3>
			<div class="acex-filter-body">

			
				<div class="acex-filter-row acex-premium acex-filter-on-sale actus-flex">
					<div class="actus-switch-group acex-on-sale">
						<label class="actus-label">On Sale</label>
						<input type="checkbox" class="acex-on-sale-checkbox" value="on_sale" ${d.on_sale?"checked":""} />
					</div>
				</div>

				<div class="acex-filter-row acex-filter-price actus-flex">
					<label class="actus-label">Price</label>
					<div class="actus-form-group actus-flex">
						<label class="actus-label actus-small" for="min_price">min:</label>
						<input class="actus-input actus-small" type="number" id="min_price" class="acex-price-input" min="0" step="0.01" value="${d.min_price||""}" />
					</div>
					<div class="actus-form-group actus-flex">
						<label class="actus-label actus-small" for="max_price">max:</label>
						<input class="actus-input actus-small" type="number" id="max_price" class="acex-price-input" min="0" step="0.01" value="${d.max_price||""}" />
					</div>
				</div>

				<div class="acex-filter-row acex-premium acex-filter-sale-price actus-flex">
					<label class="actus-label">Sale Price</label>
					<div class="actus-form-group actus-flex">
						<label class="actus-label actus-small" for="min_sale_price">min:</label>
						<input class="actus-input actus-small" type="number" id="min_sale_price" class="acex-sale-price-input" min="0" step="0.01" value="${d.min_sale_price||""}" />
					</div>
					<div class="actus-form-group actus-flex">
						<label class="actus-label actus-small" for="max_sale_price">max:</label>
						<input class="actus-input actus-small" type="number" id="max_sale_price" class="acex-sale-price-input" min="0" step="0.01" value="${d.max_sale_price||""}" />
					</div>
				</div>

				<div class="acex-filter-row acex-premium acex-filter-on-sale-dates actus-flex">
					<label class="actus-label">On Sale Dates</label>
					<div class="actus-form-group actus-flex">
						<label class="actus-label actus-small" for="date_on_sale_from">From:</label>
						<input class="actus-input actus-small" type="date" id="date_on_sale_from" class="acex-on-sale-date-input" value="${d.date_on_sale_from||""}" />
					</div>
					<div class="actus-form-group actus-flex">
						<label class="actus-label actus-small" for="date_on_sale_to">To:</label>
						<input class="actus-input actus-small" type="date" id="date_on_sale_to" class="acex-on-sale-date-input" value="${d.date_on_sale_to||""}" />
					</div>
					<button class="actus-btn actus-btn-secondary acex-clear-created-date">clear</button>
				</div>

				
				<div class="acex-filter-row acex-premium acex-filter-total-sales actus-flex">
					<label class="actus-label">Total Sales</label>
					<div class="actus-form-group actus-flex">
						<label class="actus-label actus-small" for="min_total_sales">min:</label>
						<input class="actus-input actus-small" type="number" id="min_total_sales" class="acex-sales-input" min="0" step="1" value="${d.min_total_sales||""}" />
					</div>
					<div class="actus-form-group actus-flex">
						<label class="actus-label actus-small" for="max_total_sales">max:</label>
						<input class="actus-input actus-small" type="number" id="max_total_sales" class="acex-sales-input" min="0" step="1" value="${d.max_total_sales||""}" />
					</div>
				</div>


			</div>
		</div>
	`);e.append(s),F("body").off("click.acex-select-products",".acex-on-sale-checkbox"),F("body").on("click.acex-select-products",".acex-on-sale-checkbox",a=>{let i=F(a.currentTarget),o=i.is(":checked")?"yes":"no";o==="clear"||o=="no"?delete d.on_sale:d.on_sale=o,F("body").trigger("acex::filter-changed-query",[d,i])}),F("body").off("change.acex-select-products",".actus-price-filters input:not(.acex-on-sale-checkbox)"),F("body").on("change.acex-select-products",".actus-price-filters input:not(.acex-on-sale-checkbox)",a=>{let i=F(a.currentTarget),o=parseFloat(i.val()),r=i.attr("id");F("body").trigger("acex::filter-changed",[r,o,i])}),F("body").off("change.acex-select-products",".acex-filter-on-sale-dates input"),F("body").on("change.acex-select-products",".acex-filter-on-sale-dates input",a=>{let i=F(a.currentTarget),o=i.val(),r=i.attr("id");F("body").trigger("acex::filter-changed",[r,o,i])}),F("body").off("click.acex-select-products",".acex-price-filters .actus-btn-secondary"),F("body").on("click.acex-select-products",".acex-price-filters .actus-btn-secondary",a=>{a.preventDefault();let i=F(a.currentTarget);F("body").trigger("acex::filter-clear-date",["date_on_sale_from","date_on_sale_to",i])})}var O=window.jQuery||jQuery,He=window.acex_phpDATA||{},ms=He.strings||{};function Re(d,e){let t=!!(d.stock_status||d.min_stock||d.max_stock||d.min_low_stock||d.max_low_stock),s=O(`
		<div class="acex-filter actus-stock-filters acex-premium ${t?"actus-open":""}">
			<h3>Stock<span>${He.SVG.caret}</span></h3>
			<div class="acex-filter-body">

				<div class="acex-filter-row acex-filter-stock-status actus-flex">
					<div class="actus-switch-group acex-stock-manage">
						<label class="actus-label">Manage Stock</label>
						<span alt="no" class="actus-switch ${d.manage_stock=="no"?"actus-selected":""}" />no</span>
						<span alt="yes" class="actus-switch ${d.manage_stock=="yes"?"actus-selected":""}" />yes</span>
						<span alt="clear" class="actus-switch ${d.manage_stock?"":"actus-selected"}" />clear</span>
					</div>
					<label><input type="checkbox" class="acex-stock-status-checkbox" value="instock" ${d.stock_status?.includes("instock")?"checked":""} /> In Stock</label>
					<label><input type="checkbox" class="acex-stock-status-checkbox" value="outofstock" ${d.stock_status?.includes("outofstock")?"checked":""} /> Out of Stock</label>
					<label><input type="checkbox" class="acex-stock-status-checkbox" value="onbackorder" ${d.stock_status?.includes("onbackorder")?"checked":""} /> On Backorder</label>
				</div>

				<div class="acex-filter-row acex-filter-stock-quantity actus-flex">
					<label class="actus-label">Stock</label>
					<div class="actus-form-group actus-flex">
						<label class="actus-label actus-small" for="min_stock">min:</label>
						<input class="actus-input actus-small" type="number" id="min_stock" class="acex-stock-quantity-input" min="0" value="${d.min_stock||""}" />
					</div>
					<div class="actus-form-group actus-flex">
						<label class="actus-label actus-small" for="max_stock">max:</label>
						<input class="actus-input actus-small" type="number" id="max_stock" class="acex-stock-quantity-input" min="0" value="${d.max_stock||""}" />
					</div>
				</div>

				<div class="acex-filter-row acex-filter-low-stock-quantity actus-flex">
					<label class="actus-label">Low Stock</label>
					<div class="actus-form-group actus-flex">
						<label class="actus-label actus-small" for="min_low_stock">min:</label>
						<input class="actus-input actus-small" type="number" id="min_low_stock" class="acex-low-stock-quantity-input" min="0" value="${d.min_low_stock||""}" />
					</div>
					<div class="actus-form-group actus-flex">
						<label class="actus-label actus-small" for="max_low_stock">max:</label>
						<input class="actus-input actus-small" type="number" id="max_low_stock" class="acex-low-stock-quantity-input" min="0" value="${d.max_low_stock||""}" />
					</div>
				</div>
				
				<div class="acex-filter-row acex-filter-low-stock-quantity actus-flex">
					<label class="actus-label">Shipping Classes</label>
					<div class="acex-filter-classes">
						${He.product_shipping_classes.map(a=>`<span class="actus-tag ${d.shipping_class?.includes(String(a.slug))?"actus-selected":""}" data-id="${a.term_id}" data-slug="${a.slug}">${a.name}</span>`).join("")}
					</div>
				</div>

			</div>
		</div>
	`);e.append(s),O("body").off("click.acex-select-products",".acex-stock-manage span"),O("body").on("click.acex-select-products",".acex-stock-manage span",a=>{let i=O(a.currentTarget);i.siblings().removeClass("actus-selected"),i.addClass("actus-selected");let o=i.attr("alt");o==="clear"?delete d.manage_stock:d.manage_stock=o,O("body").trigger("acex::filter-changed-query",[d,i])}),O("body").off("change.acex-select-products",".acex-stock-status-checkbox"),O("body").on("change.acex-select-products",".acex-stock-status-checkbox",a=>{let i=O(a.currentTarget),o=i.val();O("body").trigger("acex::filter-changed",["stock_status",o,i])}),O("body").off("change.acex-select-products",".acex-filter-stock-quantity input"),O("body").on("change.acex-select-products",".acex-filter-stock-quantity input",a=>{let i=O(a.currentTarget),o=parseInt(i.val()),r=i.attr("id");O("body").trigger("acex::filter-changed",[r,o,i])}),O("body").off("click.acex-select-products",".acex-filter-classes .actus-tag"),O("body").on("click.acex-select-products",".acex-filter-classes .actus-tag",a=>{let i=O(a.currentTarget),o=i.attr("data-slug");O("body").trigger("acex::filter-changed",["shipping_class",o,i])})}var v=window.jQuery||jQuery,$=window.acex_phpDATA||{},Ss=$.strings||{},{__:It}=wp.i18n,Ft={query_index:0,query_name:"All Published Products",status:["publish"]};(!$.queries||!$.queries.length)&&($.queries=Ae.map(d=>({...d})));var Ne=class{constructor(){this.categories=$.product_categories||[],this.tags=$.product_tags||[],this.attributes=$.product_attributes||[],this.shipping_classes=$.product_shipping_classes||[],this.count=0,this.products=[],this.current=$.prefs?.currentQuery||0,this.queries=$.queries||[],this.queries.length||(this.queries=predefinedQueries),this.query=JSON.parse(JSON.stringify(this.queries[this.current])),this.productCountTimeout=null,this.productsTimeout=null,this.template={columns:[]},this.$preview=v(".acex-products-preview"),this.queryUnsaved=!1,this.free=w.free}getProducts(){return console.log("SelectProducts.getProducts",this.products),this.products}async render(e,t){this.cleanup(),this.check=await w.check(),this.current=$.prefs?.currentQuery||0,this.current>=this.queries.length&&(this.current=0),this.query=JSON.parse(JSON.stringify(this.queries[this.current]||{})),this.target=e,this.template=t||{columns:[]},this.$status=v(`
				<div class="acex-select-products-status">
					<h4>Selected products: <span class="acex-selected-count">0</span></h4>
					<div class="acex-variable-status"></div>
					<div class="actus-flex-1"></div>
					<button class="actus-btn actus-btn-primary acex-button-export-google">Export to Google Sheets</button>
					<button class="actus-btn actus-btn-primary acex-button-export">Export to Excel File</button	>
				</div>
		`).appendTo(e);let s=v(`
			<div class="acex-select-products">
				<div class="acex-select-filters"></div>
			</div>
		`);e.append(s),this.$filtersContainer=s.find(".acex-select-filters"),this.$count=this.$status.find(".acex-selected-count"),this.$variable=this.$status.find(".acex-variable-status"),this.$preview=this.target.find(".acex-products-preview"),setTimeout(()=>{this.$preview=this.target.find(".acex-products-preview")},10),this.renderFilters(),v("body").off("acex::template-changed.acex-select-products"),v("body").on("acex::template-changed.acex-select-products",(a,i)=>{this.template=i})}te;async renderFilters(){await j("categories"),await j("tags"),await j("attributes"),await j("shipping_classes"),this.categories=$.product_categories||[],this.tags=$.product_tags||[],this.attributes=$.product_attributes||[],this.shipping_classes=$.product_shipping_classes||[],this.$filtersContainer.empty(),this.renderQueries(),Pe(this.query,this.$filtersContainer),Ie(this.query,this.$filtersContainer,this.categories),Fe(this.query,this.$filtersContainer,this.tags),je(this.query,this.$filtersContainer,this.attributes),Le(this.query,this.$filtersContainer),Re(this.query,this.$filtersContainer),this.filterEvents(),v("body").off("click.acex-select-products",".acex-filter h3"),v("body").on("click.acex-select-products",".acex-filter h3",function(){v(this).parent().toggleClass("actus-open")})}filterEvents(){v("body").off("acex::filter-changed-query.acex-select-products"),v("body").on("acex::filter-changed-query.acex-select-products",(e,t,s)=>{this.query=t,this.queryView()}),v("body").off("acex::filter-changed.acex-select-products"),v("body").on("acex::filter-changed.acex-select-products",(e,t,s,a)=>{if(a&&(a.prop("type")==="checkbox"||a.prop("type")==="radio")){a.is(":checked")?(this.query[t]=this.query[t]||[],this.query[t].push(s)):this.query[t]=this.query[t].filter(i=>i!==s),this.query[t]&&this.query[t].length==0&&delete this.query[t],this.queryView();return}if(a&&a.hasClass("actus-tag")){a.hasClass("actus-selected")?(a.removeClass("actus-selected"),this.query[t]=this.query[t].filter(i=>i!==s)):(a.addClass("actus-selected"),this.query[t]=this.query[t]||[],this.query[t].push(s)),this.query[t]&&this.query[t].length==0&&delete this.query[t],this.queryView();return}if(a&&a.is('input[type="number"]')){let i=a.val(),o=i===""?null:Number(i);o===null||isNaN(o)?delete this.query[t]:this.query[t]=o,this.queryView();return}s?this.query[t]=s:delete this.query[t],this.queryView()}),v("body").off("acex::filter-clear-date.acex-select-products"),v("body").on("acex::filter-clear-date.acex-select-products",(e,t,s,a)=>{a.closest(".acex-filter-row").find('input[type="date"]').val(""),delete this.query[t],delete this.query[s],this.queryView()})}renderQueries(){let e=v(".acex-query-group");e.length||(e=v(`
				<div class="acex-filter acex-query-group actus-open">
					<h3>
						Query
						<button class="actus-btn actus-btn-secondary acex-button-reset-queries">
							restore default queries
						</button>
						<span>${$.SVG.caret}</span>
					</h3>
					<div class="acex-queries">
						<div class="acex-query-view"></div>
						<div class="acex-queries-list"></div>
					</div>
					<div class="acex-queries-buttons"></div>
				</div>
			`),this.$filtersContainer.append(e)),e.find(".acex-query-view").empty();let t=e.find(".acex-queries-list").empty(),s=e.find(".acex-queries-buttons").empty();this.queryView(),this.queryList(t),v("body").off("click.acex-select-products",".acex-button-reset-queries"),v("body").on("click.acex-select-products",".acex-button-reset-queries",r=>{r.preventDefault(),this.resetQueries(t)}),v('<button class="actus-btn actus-btn-danger">').text("Delete Query").appendTo(s).on("click",async r=>{r.preventDefault(),await x.confirm("Are you sure you want to delete this query?")&&typeof this.deleteQuery=="function"&&(v(r.target).prop("disabled",!0).html($.SVG.loader),await this.deleteQuery(this.current),v(r.target).prop("disabled",!1).text("Delete Query"))}),v('<button class="actus-btn actus-btn-secondary">').text("Add Query").appendTo(s).on("click",r=>{r.preventDefault(),this.addQuery()}),v('<button class="actus-btn actus-btn-primary acex-save-query">').text("Save Query").appendTo(s).on("click",async r=>{r.preventDefault(),!(this.query._system&&(this.check=await w.check("Upgrade to the Premium version to modify default queries."),!this.check))&&(this.queries[this.current]=JSON.parse(JSON.stringify(this.query)),this.queryUnsaved=!1,v(r.target).prop("disabled",!0).html($.SVG.loader),await B("acex_queries",this.queries),v(r.target).prop("disabled",!1).text("Save Query").hide(),console.log("Query saved:",this.query))})}async resetQueries(e){await x.confirm("Are you sure you want to restore the default queries?<br>It will not affect your custom queries.")&&(this.queries=this.queries.filter(s=>!s._system),this.queries=[...Ae,...this.queries],$.queries=this.queries,await B("acex_queries",$.queries),x.success("Default queries restored successfully."),this.queryList(e),setTimeout(()=>{e.find(".acex-query-item").first().trigger("click")},0))}queryList(e){e.empty(),this.queries.forEach((t,s)=>{let a=s===this.current?"actus-selected":"",i=t.p?"acex-premium":"",o=v(`
				<div class="acex-query-item ${a} ${i}" data-index="${s}">
					<span class="acex-query-name">${t.query_name}</span>
					</div>
				`);e.append(o)}),v("body").off("click.acex-query-list",".acex-query-item"),v("body").on("click.acex-query-list",".acex-query-item",async t=>{if(!this.check&&v(t.currentTarget).hasClass("acex-premium")||this.queryUnsaved&&!await x.confirm(It("You have unsaved changes to the current query. Are you sure you want to switch queries without saving?","actus-excel-for-woo")))return;this.queryUnsaved=!1;let s=v(t.currentTarget).attr("data-index"),a=v(t.currentTarget).index();typeof this.useQuery=="function"&&this.useQuery(s)})}useQuery(e){e=parseInt(e),this.current=e,this.query=JSON.parse(JSON.stringify(this.queries[this.current])),$.prefs.currentQuery=this.current,$.prefs.save(),v(".acex-query-item").removeClass("actus-selected"),v(`.acex-query-item[data-index="${e}"]`).addClass("actus-selected"),this.renderFilters()}async addQuery(){if(this.queries.filter(a=>!a._system).length>=1&&(this.check=await w.check("Upgrade to the Premium version to create more custom queries."),!this.check))return;let t=await x.prompt("What is the name of the query?","Default Query","User Input");if(!t)return;let s={query_name:t};this.queries.push(s),this.current=this.queries.length-1,this.query=JSON.parse(JSON.stringify(s)),await B("acex_queries",this.queries),this.renderQueries()}async deleteQuery(e){this.queries.length<=1||(this.queries.splice(e,1),this.current>=this.queries.length&&(this.current=this.queries.length-1),this.current<0&&(this.current=0),this.query=JSON.parse(JSON.stringify(this.queries[this.current]))||Ft,await B("acex_queries",this.queries),this.renderQueries(),this.renderFilters())}queryView(){this.queryUnsaved=!1,v(".acex-save-query").hide(),JSON.stringify(this.query)!=JSON.stringify(this.queries[this.current])&&(this.queryUnsaved=!0,v(".acex-save-query").show());let e=v(".acex-query-group");e.find(".acex-query-view").empty(),this.getProductCount(),this.query.description=this.query.description||this.query.query_name||"";let t=Object.keys(this.query);t.includes("description")&&(t=["description",...t.filter(s=>s!=="description")]),t.forEach(s=>{if(s.startsWith("_")||s.startsWith("query_")||s.startsWith("template"))return;let a=JSON.stringify(this.query[s],null,2);s==="specific_products"&&Array.isArray(this.query.specific_products)&&this.query.specific_products.length&&(a=this.query.specific_products.map(r=>r[1].split(" - ")[1]||r[1]).join("<br>")),s==="tags"&&Array.isArray(this.query.tags)&&(a=this.query.tags.map(r=>{this.tags=$.product_tags||[];let n=this.tags.find(c=>String(c.slug)===String(r));return n?n.name:r}).join(", ")),s==="categories"&&Array.isArray(this.query.categories)&&(a=this.query.categories.map(r=>{this.categories=$.product_categories||[];let n=this.categories.find(c=>String(c.slug)===String(r));return n?n.name:r}).join(", ")),s==="shipping_class"&&Array.isArray(this.query.shipping_class)&&(a=this.query.shipping_class.map(r=>{this.shipping_classes=$.product_shipping_classes||[];let n=this.shipping_classes.find(c=>String(c.slug)===String(r));return n?n.name:r}).join(", ")),s==="attributes"&&typeof this.query.attributes=="object"&&(a=Object.entries(this.query.attributes).map(([r,n])=>{this.attributes=$.product_attributes||[],r=r.toLowerCase();let c=this.attributes.find(h=>h.attribute_name===r),l=c?c.attribute_label:r,u=Array.isArray(n)?n.map(h=>{let p=c&&c.terms?c.terms.find(m=>String(m.slug)===String(h)):null;return p?p.name:h}).join(", "):"";return`${l}: ${u}`}).join("<br>")),typeof a=="string"?a=a.replace(/^\[|\]$/g,"").replace(/^\{|\}$/g,""):Array.isArray(this.query[s])?a=a.replace(/^\[|\]$/g,""):typeof this.query[s]=="object"&&this.query[s]!==null&&(a=a.replace(/^\{|\}$/g,"")),a=a.trim(),a=a.replace(/^"|"$/g,"");let i=$.data_props[s]?$.data_props[s].label:s,o=v(`
				<div class="acex-query-field" data-key="${s}">
					<label>${i}</label>
					<div class="acex-query-value" data-key="${s}" data-value="${this.query[s]||""}">${a}</div>
				</div>
			`);if(e.find(".acex-query-view").append(o),s==="specific_products")return e.find(".acex-query-view").html(o),!1})}cleanup(){this.productCountTimeout&&(clearTimeout(this.productCountTimeout),this.productCountTimeout=null),this.productsTimeout&&(clearTimeout(this.productsTimeout),this.productsTimeout=null),v("body").off(".selectProducts"),v("body").off(".acex-props"),this.$preview=null,this.$filtersContainer=null,this.$status=null,this.$count=null,this.$variable=null}async getProductCount(){if(this.$count.text(0),!!this.query&&Object.keys(this.query).length)return this.productCountTimeout&&(clearTimeout(this.productCountTimeout),this.productCountTimeout=null),new Promise(e=>{this.$count.html($.SVG.loader),this.$preview.html(`<div class="actus-loader">${$.SVG.loader}</div>`),this.productCountTimeout=setTimeout(async()=>{let t=JSON.parse(JSON.stringify(this.query));t.specific_products&&(t.ids=t.ids||[],t.ids=[...new Set([...t.ids,...t.specific_products])],t.ids=t.ids.join(","),delete t.specific_products),this.$count.html($.SVG.loader),this.count=await re(t,!0),this.$count.text(this.count||0),this.productCountTimeout=null,e(this.count),await this.fetchProducts(t)},1e3)})}async fetchProducts(e){if(e&&Object.keys(e).length)return this.productsTimeout&&(clearTimeout(this.productsTimeout),this.productsTimeout=null),new Promise(t=>{this.productsTimeout=setTimeout(async()=>{let s=await re(e);this.products=s.products||[],this.productsTimeout=null,t(this.products);let a=this.products.slice(0,20);V.setContainer(this.$preview),V.create(this.template,a)},1e3)})}},ne=new Ne;var Ps=window.jQuery||jQuery,ie=window.acex_phpDATA||{},Is=ie.strings||{},Be=class{constructor(e,t){this.template=e||{},this.createSheet=t}async addValidations(e,t,s){let a=[],i=0,o=e.addWorksheet("_acex_helpers");o.state="hidden";let r=0,n=[],c=[];for(let l of this.template.columns){if(Object.keys(ie.data_taxonomies).includes(l.key)){let u=await this.validation_taxonomies(e,t,s,l.key,i,o,r);e=u.workbook,t=u.worksheet,i=u.insertedColumnsCount,r=u.helperSheetColCount,u.conditionalFormattingInfo&&n.push(u.conditionalFormattingInfo),u.formulaInfo&&c.push(u.formulaInfo)}if(l.key==="shipping_class"&&a.push({column:l.key,referenceSheet:"Shipping Classes",referenceHeader:"Slug",referenceColumn:"B",startRow:3}),Array.isArray(l.type)||typeof l.type=="string"&&l.type.includes(",")){let u=Array.isArray(l.type)?l.type:l.type.split(",").map(h=>h.trim());a.push({column:l.key,options:u})}if(l.type==="bool"||l.type==="boolean"){a.push({column:l.key,options:["true","false"]});let u=this.template.columns.findIndex(m=>m.key===l.key),h=this.getExcelColumnLetter(u+1),p=s+2+1e3;t.addConditionalFormatting({ref:`${h}3:${h}${p}`,rules:[{type:"expression",formulae:[`LOWER(${h}3)="true"`],style:{fill:{type:"pattern",pattern:"solid",bgColor:{argb:"FFD4EDDA"}},font:{color:{argb:"FF155724"},bold:!0}}},{type:"expression",formulae:[`LOWER(${h}3)="false"`],style:{fill:{type:"pattern",pattern:"solid",bgColor:{argb:"FFF8D7DA"}},font:{color:{argb:"FF721C24"}}}}]}),t.getColumn(u+1).alignment={horizontal:"center",vertical:"middle"}}}c.forEach(l=>{this.applyTaxonomyFormulas(t,l)}),n.forEach(l=>{let u=this.getExcelColumnLetter(l.colIndex),h=this.getExcelColumnLetter(l.helperColIndex);t.addConditionalFormatting({ref:`${u}3:${u}${l.maxRow}`,rules:[{type:"expression",formulae:[`INDIRECT("'${l.helperSheetName}'!${h}"&ROW())>0`],style:{fill:{type:"pattern",pattern:"solid",bgColor:{argb:"FFFF9999"}}}}]})}),this.validation_dropdowns(a,t,s)}validation_dropdowns(e,t,s){e.length&&e.forEach(a=>{let{column:i,options:o,referenceSheet:r,referenceHeader:n,referenceColumn:c,startRow:l}=a,u=this.template.columns.findIndex(g=>g.key===i);if(u===-1)return;let h=0;for(let g=0;g<u;g++){let f=this.template.columns[g];Object.keys(ie.data_taxonomies).includes(f.key)&&h++}let p=u+h,m=this.getExcelColumnLetter(p+1);if(r&&(!o||!o.length)){let g=c||"B",f=l||3,y=t.workbook.getWorksheet(r),S=f;if(y){let L=y.actualRowCount||y.rowCount||f;for(let W=L;W>=f;W--){let de=y.getCell(`${g}${W}`).value;if(de!=null&&de!==""){S=W;break}}}let A=`'${r}'!$${g}$${f}:$${g}$${S}`;for(let L=3;L<=s+2;L++){let W=t.getCell(`${m}${L}`);W.dataValidation={type:"list",allowBlank:!0,formulae:[A],showErrorMessage:!0,errorTitle:"Invalid Selection",error:`Please select a value from the ${n||"Options"} list`}}return}if(r&&o&&o.length>0){let g=c||"B",f=l||2,y=`'${r}'!$${g}$${f}:$${g}$${o.length+f-1}`;for(let S=3;S<=s+2;S++){let A=t.getCell(`${m}${S}`);A.dataValidation={type:"list",allowBlank:!0,formulae:[y],showErrorMessage:!0,errorTitle:"Invalid Selection",error:`Please select a value from the ${n||"Options"} list`}}}else if(o&&o.length>0){let g=`"${o.join(",")}"`;if(g.length<=255)for(let f=3;f<=s+2;f++){let y=t.getCell(`${m}${f}`);y.dataValidation={type:"list",allowBlank:!0,formulae:[g],showErrorMessage:!0,errorTitle:"Invalid Selection",error:"Please select a value from the dropdown list"}}else{let f=`${i}_options`,y=workbook.addWorksheet(f);y.addRow(["Options"]),y.getRow(1).font={bold:!0},o.forEach(A=>{y.addRow([A])});let S=`${f}!$A$2:$A$${o.length+1}`;for(let A=3;A<=s+2;A++){let L=t.getCell(`${m}${A}`);L.dataValidation={type:"list",allowBlank:!0,formulae:[S],showErrorMessage:!0,errorTitle:"Invalid Selection",error:"Please select a value from the Options list"}}}}})}async validation_taxonomies(e,t,s,a="categories",i=0,o,r=0){let n={};for(let u in ie.data_taxonomies){await j(u);let h=ie.data_taxonomies[u],p=h.labels.menu_name||h.label||u;n[u]={sheetName:p,columnKey:u,dataSource:ie[`product_${u}`],headers:["id","slug","name","description"],hasParent:!1,comment:"Multiple tags: Select from dropdown, then press F2 to edit. Add more tags on new lines (Alt+Enter) or comma-separated.",displayColumnName:p,helperColumnPrefix:u+" Name Helper",validationHelperTitle:p+" Validation (Helper)",validationRange:`${p}!$B:$B`,nameRange:`${p}!$B:$C`,promptTitle:"Enter Slugs",promptText:`Enter taxonomy slugs separated by:
\u2022 Commas: electronics,gadgets
\u2022 New lines: Alt+Enter between slugs

Names appear in the ${p} column.
Invalid slugs turn the cell RED.

\u{1F4A1} Tip: Select rows and use Home \u2192 Format \u2192 AutoFit Row Height to see all terms.`,headerNote:`\u270F\uFE0F Enter taxonomy slugs (comma or newline separated).

\u{1F440} Names appear in the ${p} column.

\u2705 Cell stays white if all slugs are valid.
\u274C Cell turns RED if any slug is invalid.

\u{1F4D6} See ${p} sheet for the Slug/Name list.`,useIds:!1,vlookupColumn:2,lookupColumn:1,namesWidth:25},h.hierarchical&&(n[u].headers=["id","slug","name","description","parent","parent name","parent slug"],n[u].hasParent=!0)}let c=n[a];if(!c)return console.error(`Unknown taxonomy type: ${a}`),{workbook:e,worksheet:t};let l=this.createSheet(c.sheetName,c.headers,c.comment);if(c.dataSource&&c.dataSource.length>0){c.dataSource.forEach(p=>{let m=[p.term_id,this.decodeHtmlEntities(p.slug),this.decodeHtmlEntities(p.name),p.description];if(c.hasParent){let g=c.dataSource.find(f=>f.term_id===p.parent);m.push(p.parent),m.push(g?this.decodeHtmlEntities(g.name):""),m.push(g?this.decodeHtmlEntities(g.slug):"")}l.addRow(m)});let u=c.hasParent?[10,40,40,60,20,40]:[10,40,40,60];u.forEach((p,m)=>{l.getColumn(m+1).width=p}),l.getColumn(1).alignment={horizontal:"center",vertical:"top"};for(let p=2;p<=u.length;p++)l.getColumn(p).alignment={horizontal:"left",vertical:"top",indent:1};l.getColumn(u.length).alignment={horizontal:"left",vertical:"top",indent:1,wrapText:!0};let h=this.addTaxonomyValidation(e,t,s,c,i,o,r);if(h)return h}return{workbook:e,worksheet:t,insertedColumnsCount:i,helperSheetColCount:r}}addTaxonomyValidation(e,t,s,a,i,o,r){let n=this.template.columns.findIndex(c=>c.key===a.columnKey);if(n!==-1){let c=0;for(let G=0;G<n;G++){let te=this.template.columns[G];Object.keys(ie.data_taxonomies).includes(te.key)&&c++}let l=n+c,u=l+2;t.spliceColumns(u,0,[]);let h=this.getExcelColumnLetter(l+1),p=this.getExcelColumnLetter(u);t.getColumn(u).width=a.namesWidth,t.getCell(`${p}1`).value=a.displayColumnName,t.getCell(`${p}1`).font={bold:!0,color:{argb:"FFFFFFFF"}},t.getCell(`${p}1`).alignment={horizontal:"center"},t.getCell(`${p}1`).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF777777"}},t.getCell(`${p}2`).value="Auto-filled",t.getCell(`${p}2`).alignment={wrapText:!0,vertical:"middle",horizontal:"center"},t.getCell(`${p}2`).font={italic:!0,color:{argb:"FF888888"}};let m=u,g=t.lastRow?.number||2,y=Math.min(Math.max(g,s+2)+100,1e4),S=this._addTaxonomyHelpers(o,a,y,r,t.name,h);for(let G=3;G<=y;G++){let te=t.getCell(`${h}${G}`);te.dataValidation={type:"textLength",operator:"lessThan",formulae:[1e4],allowBlank:!0,showInputMessage:!0,promptTitle:a.promptTitle,prompt:a.promptText,showErrorMessage:!1}}let A={colIndex:l+1,helperColIndex:S.validationHelperColIndex,helperSheetName:o.name,maxRow:y},L={cfg:a,maxRow:y,worksheetName:t.name,colIndex:l+1,displayColIndex:m,helperSheetName:o.name,nameHelperStartIndex:S.nameHelperStartIndex,nameHelperCount:S.nameHelperCount,validationHelperColIndex:S.validationHelperColIndex},W=t.getCell(1,l+1);W.note={texts:[{font:{size:11,color:{argb:"FF000000"}},text:a.headerNote}]};let de=t.getColumn(l+1),_e=this.estimateColumnWidth(this.template.columns[n].header),St=Math.min(t.rowCount||s+10,s+10);for(let G=3;G<=St;G++){let te=t.getCell(G,l+1);if(te&&te.value){let At=this.estimateColumnWidth(String(te.value||""));_e=Math.max(_e,At)}}return de.width=Math.min(Math.max(_e,10)+2,50),i+=1,{workbook:e,worksheet:t,insertedColumnsCount:i,helperSheetColCount:S.newHelperSheetColCount,conditionalFormattingInfo:A,formulaInfo:L}}return!1}_addTaxonomyHelpers(e,t,s,a,i,o){let n=a+1;for(let u=0;u<10;u++){let h=n+u,p=this.getExcelColumnLetter(h);e.getColumn(h).width=30,e.getCell(`${p}1`).value=`${t.helperColumnPrefix} ${u+1}`,e.getCell(`${p}1`).font={italic:!0,color:{argb:"FFBBBBBB"}};for(let m=3;m<=s;m++){let g=(u+1)*99-98,f=`LET(_raw,SUBSTITUTE('${i}'!${o}${m},CHAR(10),","),_token,TRIM(MID(SUBSTITUTE(_raw,",",REPT(" ",99)),${g},99)),IF(_token="","",IFERROR(VLOOKUP(_token,${t.nameRange},${t.vlookupColumn},FALSE),"[invalid slug]")))`;e.getCell(`${p}${m}`).value={formula:f}}}let c=n+10,l=this.getExcelColumnLetter(c);e.getColumn(c).width=15,e.getCell(`${l}1`).value=t.validationHelperTitle,e.getCell(`${l}1`).font={bold:!0,color:{argb:"FF888888"}},e.getCell(`${l}2`).value=`0 = Valid IDs
>0 = Invalid`,e.getCell(`${l}2`).alignment={wrapText:!0,vertical:"top"},e.getCell(`${l}2`).font={italic:!0,color:{argb:"FF888888"}};for(let u=3;u<=s;u++){let h=`IF('${i}'!${o}${u}="",0,LET(_raw,SUBSTITUTE('${i}'!${o}${u},CHAR(10),","),_arr,IFERROR(TEXTSPLIT(_raw,","),TRIM(MID(SUBSTITUTE(_raw,",",REPT(" ",99)),ROW(INDIRECT("1:200"))*99-98,99))),_trim,TRIM(_arr),SUMPRODUCT(--(LEN(_trim)>0),--(COUNTIF(${t.validationRange},_trim)=0))))`;e.getCell(`${l}${u}`).value={formula:h}}return{nameHelperStartIndex:n,nameHelperCount:10,validationHelperColIndex:c,newHelperSheetColCount:a+10+1}}applyTaxonomyFormulas(e,t){let{cfg:s,maxRow:a,colIndex:i,displayColIndex:o,helperSheetName:r,nameHelperStartIndex:n,nameHelperCount:c,validationHelperColIndex:l}=t,u=this.getExcelColumnLetter(i),h=this.getExcelColumnLetter(o),p=[];for(let f=0;f<c;f++)p.push(this.getExcelColumnLetter(n+f));let m=p[0],g=p[p.length-1];for(let f=3;f<=a;f++){let y=e.getCell(`${h}${f}`),S=`IF(${u}${f}="", "", LET(_names,'${r}'!${m}${f}:${g}${f},_joined,TEXTJOIN(CHAR(10),TRUE,_names),IF(_joined="","[no matches]",_joined)))`,A=e.getRow(f);A.height=void 0,y.value={formula:S},y.alignment={wrapText:!0,vertical:"top",horizontal:"center"},y.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEFF5FF"}},y.font={color:{argb:"FF1F4E78"}},y.protection={locked:!0},y.border={top:{style:"thin",color:{argb:"FFDDDDDD"}},bottom:{style:"thin",color:{argb:"FFDDDDDD"}}}}}getExcelColumnLetter(e){let t="";for(;e>0;){let s=(e-1)%26;t=String.fromCharCode(65+s)+t,e=Math.floor((e-1)/26)}return t}decodeHtmlEntities(e){if(!e||typeof e!="string")return e;try{return decodeURIComponent(e)}catch{return e}let t=document.createElement("textarea");return t.innerHTML=e,t.value}estimateColumnWidth(e){if(!e)return 8;let s=String(e).split(`
`).reduce((i,o)=>o.length>i.length?o:i,""),a=0;for(let i of s)/[A-Z0-9@#$%&*]/.test(i)?a+=1.2:/[il!|']/.test(i)?a+=.5:a+=1;return Math.ceil(a)}},Me=Be;var Hs=window.jQuery||jQuery,E=window.acex_phpDATA||{},Rs=E.strings||{},{__:Ns}=wp.i18n,qe=class{constructor(e,t){this.template=e||{},this.query=t||{},this.free=w.free,this.workbook=null,this.worksheet=null}async create2(e){let t=await this.createBase(),s=await this.createWorksheet();this.addProductRows(e);let a=await this.finalize(e)}async createBase(){if(typeof ExcelJS>"u")throw new Error('ExcelJS library is not loaded. Please include: <script src="https://cdn.jsdelivr.net/npm/exceljs@4.3.0/dist/exceljs.min.js"><\/script>');return this.check=await w.check(),this.KEYS=this.template.columns,this.check||(this.KEYS=this.template.columns.filter(e=>this.free.props.includes(e.key))),this.workbook=new ExcelJS.Workbook,this.workbook.creator="Actus Excel for WooCommerce",this.workbook.created=new Date,this.workbook.calcProperties.fullCalcOnLoad=!0,this.workbook}async createWorksheet(){let e=this.template.sheet||"Products";this.worksheet=this.workbook.addWorksheet(e),this.worksheet.properties.outlineLevelRow=0,this.worksheet.properties.defaultRowHeight=15,this.worksheet.properties.dyDescent=0,this.worksheet.properties.defaultColWidth=10;let t=this.createHeaders(this.worksheet);return this.worksheet=this.addDescriptions(this.worksheet),this.worksheet.views=[{state:"frozen",ySplit:1}],this.worksheet._headers=t,this.rows=["H","h"],this.worksheet}async finalize(){return this.autoSizeColumns(),this.styleCells(),await this.createShippingClassesSheet(),await this.createAttributesSheet(),await this.createAttributesTermsSheet(),await new Me(this.template,this.createSheet.bind(this)).addValidations(this.workbook,this.worksheet,this.rows.length-2),this.worksheet.protect("",{selectLockedCells:!0,selectUnlockedCells:!0}),this.enforceRowHeightLimit(150),this.workbook}async create(e){if(typeof ExcelJS>"u")throw new Error('ExcelJS library is not loaded. Please include: <script src="https://cdn.jsdelivr.net/npm/exceljs@4.3.0/dist/exceljs.min.js"><\/script>');this.check=await w.check(),this.KEYS=this.template.columns,this.check||(this.KEYS=this.template.columns.filter(r=>this.free.props.includes(r.key)));let t=new ExcelJS.Workbook;t.creator="Actus Excel for WooCommerce",t.created=new Date,t.calcProperties.fullCalcOnLoad=!0;let s=this.template.sheet||"Products",a=t.addWorksheet(s),i=this.createHeaders(a);return a=this.addDescriptions(a),a.views=[{state:"frozen",ySplit:2}],this.addProductRows(a,e),this.autoSizeColumns(a,e,i),this.styleCells(a,e),await this.createShippingClassesSheet(),await this.createAttributesSheet(),await this.createAttributesTermsSheet(),await new Me(this.template,this.createSheet.bind(this)).addValidations(t,a,e.length),a.protect("",{selectLockedCells:!0,selectUnlockedCells:!0}),t}createHeaders(e){let t=this.KEYS.map(a=>a.header);e.addRow(t),e.getRow(1).font={bold:!0,color:{argb:"FFFFFFFF"}},e.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF777777"}},e.getRow(1).alignment={horizontal:"center",vertical:"middle"};let s=this.KEYS.map(a=>a.key);return e.addRow(s),e.getRow(2).alignment={horizontal:"center",vertical:"middle"},t}addProductRows(e){for(let t of e){let s="-",a=t.type==="variation";a&&(s="variation"),this.rows.push(s);let i=this.KEYS.map(r=>{let n=this.getProductValue(t,r.key,r.type);if(r.key.includes("date_")&&n){let l=new Date(n);if(!isNaN(l.getTime()))return l}if(typeof n=="object"&&n!==null)return JSON.stringify(n);let c=E.data_mustBeInherited&&E.data_mustBeInherited.includes(r.key);return a&&c&&r.key,n??""}),o=this.worksheet.addRow(i);this.KEYS.forEach((r,n)=>{if(r.key.includes("date_")){let c=o.getCell(n+1);c.numFmt="yyyy-mm-dd hh:mm:ss"}})}}autoSizeColumns(){this.worksheet._headers.forEach((e,t)=>{let s=this.worksheet.getColumn(t+1),a=this.estimateColumnWidth(e),i=0,o=Math.min(this.rows.length,1e3);for(let r=3;r<=o;r++){let n=this.worksheet.getCell(r,t+1);if(n&&n.value){let c=this.estimateColumnWidth(String(n.value||""));i=Math.max(i,c)}}s.width=Math.min(Math.max(a,i,10)+2,50)})}styleCells(){let e=this.rows.length;for(let t=3;t<=e;t++){let s=this.worksheet.getRow(t),a=this.rows[t-1]==="variation",i=15;this.KEYS.forEach((n,c)=>{let l=s.getCell(c+1),h=n&&(n.type==="number"||n.type==="float"||n.type==="int"||n.type==="integer"||n.type==="decimal")?"right":"left";h=n.align||h,l.alignment={wrapText:!0,vertical:"top",horizontal:h,indent:1};let p=E.data_mustBeInherited&&E.data_mustBeInherited.includes(n.key);a&&p?(l.protection={locked:!0},l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE0E0E0"}},l.font={color:{argb:"FF999999"}}):l.protection={locked:!1};let m=this.calculateCellHeight(l.value,c,this.KEYS)||15;i=Math.max(i,m)});let r=Math.min(i,100);s.height=r,s.model.customHeight=!0,s.customHeight=!0,s.commit()}this.worksheet.getRow(2).alignment={horizontal:"center",vertical:"middle"}}addDescriptions(e){let t=this.KEYS.map(s=>s.key);return this.KEYS.forEach((s,a)=>{E.data_props[s.key]=E.data_props[s.key]||{};let i="";i=E.data_props&&E.data_props[s.key]&&E.data_props[s.key].description?E.data_props[s.key].description:"";let o="FFBBBBBB";E.data_warnings&&E.data_warnings[s.key]&&(o="FFFFB84D",i+=`

\u26A0\uFE0F `+E.data_warnings[s.key]),E.data_restrictions&&E.data_restrictions[s.key]&&(i+=`

\u2757 `+E.data_restrictions[s.key],o="FFFFAAAA");let r=e.getCell(2,a+1),n=i.split(`
`),c=[{font:{bold:!0,size:11,color:{argb:"FF000000"},name:"Calibri"},text:E.data_props[s.key].meta_key+`
`}];n.forEach((l,u)=>{c.push({font:{size:11,color:{argb:"FF000000"},name:"Calibri"},text:l+(u<n.length-1?`
`:"")})}),r.note={texts:c,margins:{insetmode:"auto"}},r.fill={type:"pattern",pattern:"solid",fgColor:{argb:o}},r.font={italic:!0,color:{argb:"FFFFFFFF"}},r.alignment={wrapText:!0,vertical:"top",horizontal:"center",indent:1}}),e}async createShippingClassesSheet(){if(!this.KEYS.some(i=>i.key==="shipping_class"))return;let t=[{header:"ID",key:"term_id",alignment:{horizontal:"center",indent:1}},{header:"Slug",key:"slug",alignment:{horizontal:"left",indent:1}},{header:"Name",key:"name",alignment:{horizontal:"left",indent:1}},{header:"Description",key:"description",alignment:{horizontal:"left",indent:1}},{header:"Count",key:"count",alignment:{horizontal:"center",indent:1}}],s=[];await j("shipping_classes"),(E.product_shipping_classes||[]).forEach(i=>{let o=i.term_id||"",r=i.slug||"",n=i.name||"",c=i.description||"",l=i.count||0;s.push([o,r,n,c,l])}),this.createSheet("Shipping Classes",t,"Product shipping classes configuration",s)}async createAttributesSheet(){let e=["attributes","attribute_values","default_attributes"];if(!this.KEYS.some(o=>e.includes(o.key)))return;let s=[{header:"ID",key:"id",alignment:{horizontal:"center",indent:1}},{header:"Slug",key:"slug",alignment:{horizontal:"left",indent:1}},{header:"Label",key:"label",alignment:{horizontal:"left",indent:1}},{header:"Type",key:"type",alignment:{horizontal:"left",indent:1}},{header:"Is Visible",key:"is_visible",alignment:{horizontal:"center",indent:1}},{header:"Options",key:"options",alignment:{horizontal:"left",wrapText:!0,indent:1}}],a=[];await j("attributes"),(E.product_attributes||[]).forEach(o=>{let r=o.attribute_id||"",n=o.attribute_name||"",c=o.attribute_label||"",l=o.attribute_type||"select",u=o.attribute_public===1?"Yes":"No",p=(o.terms||[]).map(m=>this.decodeHtmlEntities(m.slug)).join(`
`);a.push([r,n,c,l,u,p])}),this.createSheet("Attributes",s,"Product attributes configuration",a)}async createAttributesTermsSheet(){let e=["attributes","attribute_values","default_attributes"];if(!this.KEYS.some(o=>e.includes(o.key)))return;let s=[{header:"Attribute",key:"attribute_name",alignment:{horizontal:"center",indent:1}},{header:"Term ID",key:"term_id",alignment:{horizontal:"center",indent:1}},{header:"Name",key:"name",alignment:{horizontal:"left",indent:1}},{header:"Slug",key:"slug",alignment:{horizontal:"left",indent:1}},{header:"Description",key:"description",alignment:{horizontal:"left",indent:1}},{header:"Count",key:"count",alignment:{horizontal:"center",indent:1}}],a=[];await j("attributes"),(E.product_attributes||[]).forEach(o=>{let r=o.attribute_name||"";(o.terms||[]).forEach(c=>{let l=c.term_id||"",u=this.decodeHtmlEntities(c.name)||"",h=this.decodeHtmlEntities(c.slug)||"",p=this.decodeHtmlEntities(c.description)||"",m=c.count||0;a.push([r,l,u,h,p,m])})}),this.createSheet("Attribute Terms",s,"Detailed list of all attribute terms with their properties",a)}getProductValue(e,t,s){if(t.includes(".")){let i=t.split("."),o=e;for(let r of i)if(o&&typeof o=="object")o=o[r];else return null;return this.decodeHtmlEntities(o)}let a=e[t];if(a===void 0&&e.meta_data&&(a=e.meta_data[t]),a===void 0&&e.meta_data){let i=t.startsWith("_")?t:"_"+t;a=e.meta_data[i]}if(s==="bool"||s==="boolean")return a?"true":"false";if(s==="int"){let i=parseInt(a);return isNaN(i)?0:i}if(s==="float"){let i=parseFloat(a);return isNaN(i)?0:i}if(Object.keys(E.data_taxonomies).includes(t))return(Array.isArray(a)?a.map(o=>o&&o.slug!==void 0?this.decodeHtmlEntities(o.slug):this.decodeHtmlEntities(o)):[]).filter(o=>o!=null&&o!=="").join(`
`);if(t==="attributes"&&Array.isArray(a)){let i=a.map(o=>{let r={...o};return r.name&&(r.name=this.decodeHtmlEntities(r.name)),Array.isArray(r.options)&&(r.options=r.options.map(n=>this.decodeHtmlEntities(n))),r});return JSON.stringify(i,null,2)}if(t==="attribute_values"&&a&&typeof a=="object"){let i={};for(let[o,r]of Object.entries(a)){let n=this.decodeHtmlEntities(o),c=this.decodeHtmlEntities(r);i[n]=c}return JSON.stringify(i,null,2)}return s==="array"||s==="comma-separated"&&Array.isArray(a)?(a=a||[],a.join(`
`)):Array.isArray(a)?a.length>0&&a[0].slug?a.map(i=>this.decodeHtmlEntities(i.slug)).join(`
`):JSON.stringify(a,null,2):a&&typeof a=="object"?a.slug?this.decodeHtmlEntities(a.slug):(a.name,JSON.stringify(a,null,2)):this.decodeHtmlEntities(a)}createSheet(e,t,s,a){let i=this.workbook.addWorksheet(e);typeof t[0]=="string"&&(t=t.map(n=>({header:n,key:n}))),i.addRow(t.map(n=>n.header));let o=i.getRow(1);o.font={bold:!0,color:{argb:"FFFFFFFF"}},o.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF777777"}},o.alignment={horizontal:"center",vertical:"middle"},i.mergeCells(2,1,2,t.length);let r=i.getCell(2,1);r.value=s||"",r.font={italic:!0,color:{argb:"FFFFFFFF"}},r.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFAAAAAA"}},r.alignment={wrapText:!0,horizontal:"center",vertical:"middle"},a&&(Array.isArray(a)?a.forEach(n=>{i.addRow(n)}):i.addRow([a]));for(let n=3;n<=i.rowCount;n++)i.getRow(n).eachCell((l,u)=>{let h=t[u-1]&&t[u-1].alignment?t[u-1].alignment:{};l.alignment={wrapText:!0,vertical:"top",horizontal:h.horizontal||"left",indent:h.indent||1,...h}});return i.columns.forEach((n,c)=>{let l=0,u=o.getCell(c+1).value;l=u?String(u).length:0;for(let h=3;h<=i.rowCount;h++){let p=i.getRow(h).getCell(c+1).value;if(p){let m=String(p).split(`
`).reduce((g,f)=>Math.max(g,f.length),0);m>l&&(l=m)}}n.width=Math.min(l+6,50)}),i}decodeHtmlEntities(e){if(!e||typeof e!="string")return e;try{return decodeURIComponent(e)}catch{return e}let t=document.createElement("textarea");return t.innerHTML=e,t.value}estimateColumnWidth(e){if(!e)return 8;let s=String(e).split(`
`).reduce((i,o)=>o.length>i.length?o:i,""),a=0;for(let i of s)/[A-Z0-9@#$%&*]/.test(i)?a+=1.2:/[il!|']/.test(i)?a+=.5:a+=1;return Math.ceil(a)}calculateCellHeight(e,t,s){if(!e)return 15;let i=this.worksheet?this.worksheet.getColumn(t+1):null,o=i&&i.width||s&&s[t]&&s[t].width||10,r=Math.max(Math.floor(o*1.1),1),c=String(e).split(`
`).reduce((l,u)=>l+Math.max(Math.ceil(u.length/r),1),0);return Math.max(15,c*15)}calculateRowHeight(e,t){let a=1;return e.forEach((i,o)=>{if(!i)return;let r=String(i),n=t[o]&&t[o].width||50,c=(r.match(/\n/g)||[]).length,l=r.split(`
`),u=0;l.forEach(h=>{let p=Math.ceil(h.length/n);u+=Math.max(p,1)}),a=Math.max(a,u)}),a*15}capRowHeights(e=150){if(!this.worksheet)return;let t=this.worksheet.model;t&&(t.sheetFormat=t.sheetFormat||{},t.sheetFormat.customHeight=1,Array.isArray(t.rows)&&t.rows.forEach(s=>{if(!s)return;let a=Math.min(s.height||e,e);s.height=a,s.customHeight=1})),this.worksheet.eachRow({includeEmpty:!0},(s,a)=>{if(a<=2||!s)return;let i=Math.min(s.height||e,e);s.height=i,s.customHeight=!0,s.commit()})}enforceRowHeightLimit(e=150){if(!this.worksheet)return;let t=this.worksheet._rows||[];for(let s=2;s<t.length;s++){let a=t[s];if(!a)continue;let i=Math.min(typeof a._height=="number"?a._height:e,e);a._height=i,a._customHeight=!0,a.model&&(a.model.height=i,a.model.customHeight=!0);let o=this.worksheet.getRow(s+1);o.height=i,o.customHeight=!0,o.commit()}}},mt=qe;var k=window.jQuery||jQuery,M=window.acex_phpDATA||{},Gs=M.strings||{},{__:le}=wp.i18n,Ue=class{constructor(){this.template=null,this.free=w.free,this.$target=null,this.$propsContainer=null,this.$selectAllButton=null}async init(){}events(){k("body").off("click.acex-props",".acex-group-checkbox"),k("body").on("click.acex-props",".acex-group-checkbox",async e=>{e.preventDefault(),e.stopPropagation(),!(this.template.system&&(this.check=await w.check("Upgrade to the Premium version to modify system templates."),!this.check))&&this.toggleGroup(e)}),k("body").off("click.acex-props",".acex-prop-item"),k("body").on("click.acex-props",".acex-prop-item",async e=>{e.preventDefault(),e.stopPropagation(),!(this.template.system&&(this.check||k(".actus-modal-overlay").remove(),this.check=await w.check("Upgrade to the Premium version to modify system templates."),!this.check))&&this.selectProperty(e)})}async render(e,t){if(!e)return;this.$target=e||null,this.template=t||null,this.check=await w.check();let s=k('<div class="acex-section acex-properties-section">').appendTo(this.$target),a=k("<h3>").text(le("Product Properties","actus-excel-for-woo")).appendTo(s);this.$selectAllButton=k('<button class="actus-btn actus-btn-secondary actus-small">').text(le("Select All Properties","actus-excel-for-woo")).on("click",this.toggleAll.bind(this)).appendTo(a),k("<p>").text(le("Select the product properties you want to include in the export.","actus-excel-for-woo")).appendTo(s),this.$propsContainer=k('<div class="acex-props-container">').appendTo(this.$target);for(let i in M.data_groups){let o=M.data_groups[i],r="";this.free.groups.includes(i)||(r="acex-premium");let n=k('<div class="acex-prop-group">').addClass(r).attr("data-group",i).appendTo(this.$propsContainer),c=k('<div class="acex-prop-group-header">').appendTo(n);k('<input type="checkbox" class="acex-group-checkbox">').appendTo(c);let l=k("<h4>").text(o.label).attr("data-title",o.description).appendTo(c),u=k('<div class="acex-prop-list">').appendTo(n),h=this.filterByGroup(i);if(i==="meta"&&(h=M.data_meta||[],n.addClass("is-closed"),l.prepend('<span class="acex-caret"></span>'),u.hide(),c.on("click",function(p){if(k(p.target).is("input.acex-group-checkbox"))return;let m=k(this).closest(".acex-prop-group");m.toggleClass("is-closed"),m.find(".acex-prop-list").slideToggle()})),!!Object.keys(h).length){for(let p in h){let m=h[p],g=m.meta_key,f=this.template.columns.some(W=>W.key===p),y=m.description;m.type&&Array.isArray(m.type)&&(Array.isArray(m.type)?y+=`
(`+m.type.join(", ")+")":y+=`
(`+m.type+")");let S="",A="";this.free.props.includes(p)||(S="acex-premium",this.check||(y=`\u{1F512} PREMIUM property

`+y)),M.data_warnings&&M.data_warnings[p]&&(S+=" has-warning",A=M.SVG["warning-filled"],y+=`

\u26A0\uFE0F `+M.data_warnings[p]),M.data_restrictions&&M.data_restrictions[p]&&(S+=" has-restriction",A=M.SVG["warning-filled"],y+=`

\u2757 `+M.data_restrictions[p]);let L=k(`<div class="acex-prop-item ${S}" title="${y}" data-type="${m.type||""}" data-align="${m.align||""}">
						<input type="checkbox" id="prop_${p}" name="prop_${p}" value="${p}" ${f?"checked":""}>
						<div class="acex-prop-warning" title="${g||p||""}">${A}</div>
						<label for="prop_${p}">${m.label}</label>
					</div>
				`).appendTo(u);f&&L.addClass("selected")}this.checkGroupCheckboxState(n)}}this.events()}toggleAll(e){let s=k(e.currentTarget).text()===le("Select All Properties","actus-excel-for-woo");this.$propsContainer.find(".acex-prop-group").each((a,i)=>{k(i).find(".acex-prop-item").each((r,n)=>{let c=k(n),l=c.find('input[type="checkbox"]'),u=l.val(),h=c.find("label").text(),p=c.attr("data-type")||"string",m=c.attr("data-align")||"left";l.prop("checked")!==s?this.template.columns.some(g=>g.key===u)||this.template.columns.push({header:h,key:u,type:p,align:m}):this.template.columns=this.template.columns.filter(g=>g.key!==u)})}),k("body").trigger("acex::template-changed",[this.template])}toggleGroup(e){let t=k(e.currentTarget),s=t.closest(".acex-prop-group"),a=t.prop("checked");s.find('.acex-prop-item input[type="checkbox"]').each((i,o)=>{let r=k(o).val(),n=this.template.columns.some(c=>c.key===r);if(!n&&a){let c=k(o).closest(".acex-prop-item"),l=c.find("label").text(),u=c.attr("data-type"),h=c.attr("data-align");this.template.columns.push({header:l,key:r,type:u,align:h})}else n&&!a&&(this.template.columns=this.template.columns.filter(c=>c.key!==r))}),k("body").trigger("acex::template-changed",[this.template])}selectProperty(e){this._selectPropertyThrottle||(this._selectPropertyThrottle={lastCall:0,timer:null});let t=this._selectPropertyThrottle,s=Date.now();if(s-t.lastCall<300){clearTimeout(t.timer),t.timer=setTimeout(()=>{t.lastCall=Date.now(),this._selectProperty(e)},300);return}t.lastCall=s,this._selectProperty(e)}_selectProperty(e){e.stopPropagation(),e.preventDefault();let t=k(e.currentTarget),s=t.attr("data-type"),a=t.attr("data-align"),i=t.find('input[type="checkbox"]');i.prop("checked",!i.prop("checked")),t.toggleClass("selected",i.prop("checked"));let o=i.val(),r=t.find("label").text();this.template.columns=this.template.columns||[],i.prop("checked")?this.template.columns.some(n=>n.key===o)||this.template.columns.push({header:r,key:o,type:s,align:a}):this.template.columns=this.template.columns.filter(n=>n.key!==o),V.create(this.template),this.checkGroupCheckboxState(t.closest(".acex-prop-group"))}filterByGroup(e,t=M.data_props){let s=Object.fromEntries(Object.entries(t).filter(([a,i])=>i.group===e));if(e==="taxonomies"){let a=M.data_taxonomies||{};Object.keys(a).forEach(i=>{let o=i;i=="product_cat"&&(o="categories"),i=="product_tag"&&(o="tags"),s[o]={align:"center",description:a[i].description||a[i].label||"",group:"taxonomies",label:a[i].label,meta_key:i,type:"array",hierarchical:a[i].hierarchical||!1}})}return s}checkGroupCheckboxState(e){let t=e.find(".acex-group-checkbox"),s=e.find('.acex-prop-item input[type="checkbox"]'),a=s.length,i=s.filter(":checked").length;if(i===0?(t.prop("checked",!1),t.prop("indeterminate",!1)):i===a?(t.prop("checked",!0),t.prop("indeterminate",!1)):t.prop("indeterminate",!0),this.$selectAllButton){let o=this.$propsContainer.find('.acex-prop-item input[type="checkbox"]');o.filter(":checked").length===o.length?this.$selectAllButton.text(le("Deselect All Properties","actus-excel-for-woo")):this.$selectAllButton.text(le("Select All Properties","actus-excel-for-woo"))}}cleanup(){k("body").off(".acex-props"),this.$propsContainer&&(this.$propsContainer.remove(),this.$propsContainer=null),this.$selectAllButton&&(this.$selectAllButton.remove(),this.$selectAllButton=null)}},Ve=new Ue;var Ot=[{name:"\u{1F4B0} Pricing Updates",system:!0,sheet:"Products",description:"Update prices for seasonal sales and promotions",columns:[{header:"Product ID",key:"id",type:"int",align:"center"},{header:"Product Name",key:"name",type:"string"},{header:"SKU",key:"sku",type:"string"},{header:"Regular Price",key:"regular_price",type:"float"},{header:"Sale Price",key:"sale_price",type:"float"},{header:"Sale Start Date",key:"date_on_sale_from",type:"datetime"},{header:"Sale End Date",key:"date_on_sale_to",type:"datetime"},{header:"Categories",key:"categories",type:"array",align:"center"},{header:"Status",key:"status",type:["publish","draft","pending","private"],align:"center"}]},{name:"\u{1F4E6} Inventory Management",system:!0,sheet:"Products",description:"Weekly stock reconciliation and warehouse updates",columns:[{header:"Product ID",key:"id",type:"int",align:"center"},{header:"SKU",key:"sku",type:"string"},{header:"Product Name",key:"name",type:"string"},{header:"Stock Quantity",key:"stock_quantity",type:"int"},{header:"Stock Status",key:"stock_status",type:["instock","outofstock","onbackorder"],align:"center"},{header:"Manage Stock",key:"manage_stock",type:"boolean"},{header:"Backorders",key:"backorders",type:["no","notify","yes"],align:"center"},{header:"Low Stock Amount",key:"low_stock_amount",type:"int"},{header:"Sold Individually",key:"sold_individually",type:"boolean"}]},{name:"\u{1F680} Full Product Export",system:!0,sheet:"Products",description:"Complete product data for site migration or backup",columns:[{header:"Product ID",key:"id",type:"int",align:"center"},{header:"Product Name",key:"name",type:"string"},{header:"Slug",key:"slug",type:"string"},{header:"Status",key:"status",type:["publish","draft","pending","private"],align:"center"},{header:"Product Type",key:"type",type:["simple","variable","grouped","external"],align:"center"},{header:"SKU",key:"sku",type:"string"},{header:"Regular Price",key:"regular_price",type:"float"},{header:"Sale Price",key:"sale_price",type:"float"},{header:"Description",key:"description",type:"string"},{header:"Short Description",key:"short_description",type:"string"},{header:"Categories",key:"categories",type:"array",align:"center"},{header:"Tags",key:"tags",type:"array",align:"center"},{header:"Stock Quantity",key:"stock_quantity",type:"int"},{header:"Stock Status",key:"stock_status",type:["instock","outofstock","onbackorder"],align:"center"},{header:"Weight",key:"weight",type:"float"},{header:"Length",key:"length",type:"float"},{header:"Width",key:"width",type:"float"},{header:"Height",key:"height",type:"float"},{header:"Main Image",key:"image_id",type:"int",align:"center"},{header:"Gallery Images",key:"gallery_image_ids",type:"comma-separated",align:"center"}]},{name:"\u{1F3AF} SEO Optimization",system:!0,sheet:"Products",description:"Optimize product titles, slugs, and descriptions",columns:[{header:"Product ID",key:"id",type:"int",align:"center"},{header:"Product Name",key:"name",type:"string"},{header:"Slug",key:"slug",type:"string"},{header:"Description",key:"description",type:"string"},{header:"Short Description",key:"short_description",type:"string"},{header:"Categories",key:"categories",type:"array",align:"center"},{header:"Tags",key:"tags",type:"array",align:"center"},{header:"Status",key:"status",type:["publish","draft","pending","private"],align:"center"},{header:"Featured",key:"featured",type:"boolean"}]},{name:"\u{1F3F7}\uFE0F Categories & Tags",system:!0,sheet:"Products",description:"Restructure product taxonomy and organization",columns:[{header:"Product ID",key:"id",type:"int",align:"center"},{header:"Product Name",key:"name",type:"string"},{header:"SKU",key:"sku",type:"string"},{header:"Categories",key:"categories",type:"array",align:"center"},{header:"Tags",key:"tags",type:"array",align:"center"},{header:"Product Type",key:"type",type:["simple","variable","grouped","external"],align:"center"},{header:"Status",key:"status",type:["publish","draft","pending","private"],align:"center"},{header:"Featured",key:"featured",type:"boolean"},{header:"Menu Order",key:"menu_order",type:"int",align:"center"}]},{name:"\u{1F3A8} Product Attributes",system:!0,sheet:"Products",description:"Manage attributes and variations",columns:[{header:"Product ID",key:"id",type:"int",align:"center"},{header:"Product Name",key:"name",type:"string"},{header:"SKU",key:"sku",type:"string"},{header:"Product Type",key:"type",type:["simple","variable","grouped","external"],align:"center"},{header:"Product Attributes",key:"attributes",type:"serialized"},{header:"Attribute Values",key:"attribute_values",type:"serialized"},{header:"Default Attributes",key:"default_attributes",type:"serialized"},{header:"Status",key:"status",type:["publish","draft","pending","private"],align:"center"}]},{name:"\u{1F4F8} Image Management",system:!0,sheet:"Products",description:"Bulk assign and update product images",columns:[{header:"Product ID",key:"id",type:"int",align:"center"},{header:"SKU",key:"sku",type:"string"},{header:"Product Name",key:"name",type:"string"},{header:"Main Image",key:"image_id",type:"int",align:"center"},{header:"Gallery Images",key:"gallery_image_ids",type:"comma-separated",align:"center"},{header:"Categories",key:"categories",type:"array",align:"center"},{header:"Status",key:"status",type:["publish","draft","pending","private"],align:"center"}]},{name:"\u{1F504} Supplier Integration",system:!0,sheet:"Products",description:"Import supplier data and updates",columns:[{header:"SKU",key:"sku",type:"string"},{header:"Product Name",key:"name",type:"string"},{header:"Regular Price",key:"regular_price",type:"float"},{header:"Sale Price",key:"sale_price",type:"float"},{header:"Stock Quantity",key:"stock_quantity",type:"int"},{header:"Stock Status",key:"stock_status",type:["instock","outofstock","onbackorder"],align:"center"},{header:"Description",key:"description",type:"string"},{header:"Weight",key:"weight",type:"float"},{header:"Length",key:"length",type:"float"},{header:"Width",key:"width",type:"float"},{header:"Height",key:"height",type:"float"}]},{name:"\u{1F383} Seasonal Products",system:!0,sheet:"Products",description:"Enable/disable seasonal products",columns:[{header:"Product ID",key:"id",type:"int",align:"center"},{header:"Product Name",key:"name",type:"string"},{header:"SKU",key:"sku",type:"string"},{header:"Status",key:"status",type:["publish","draft","pending","private"],align:"center"},{header:"Categories",key:"categories",type:"array",align:"center"},{header:"Tags",key:"tags",type:"array",align:"center"},{header:"Stock Status",key:"stock_status",type:["instock","outofstock","onbackorder"],align:"center"},{header:"Catalog Visibility",key:"catalog_visibility",type:["visible","catalog","search","hidden"],align:"center"},{header:"Featured",key:"featured",type:"boolean"}]},{name:"\u26A1 Quick Edit",system:!0,sheet:"Products",description:"Essential fields for quick updates",columns:[{header:"Product ID",key:"id",type:"int",align:"center"},{header:"Product Name",key:"name",type:"string"},{header:"SKU",key:"sku",type:"string"},{header:"Status",key:"status",type:["publish","draft","pending","private"],align:"center"},{header:"Regular Price",key:"regular_price",type:"float"},{header:"Stock Quantity",key:"stock_quantity",type:"int"}]},{name:"\u{1F4E6} Shipping Details",system:!0,sheet:"Products",description:"Manage shipping dimensions and classes",columns:[{header:"Product ID",key:"id",type:"int",align:"center"},{header:"Product Name",key:"name",type:"string"},{header:"SKU",key:"sku",type:"string"},{header:"Weight",key:"weight",type:"float"},{header:"Length",key:"length",type:"float"},{header:"Width",key:"width",type:"float"},{header:"Height",key:"height",type:"float"},{header:"Shipping Class",key:"shipping_class",type:"string",align:"center"},{header:"Virtual",key:"virtual",type:"boolean"}]},{name:"\u{1F4BE} Digital Products",system:!0,sheet:"Products",description:"Manage downloadable and virtual products",columns:[{header:"Product ID",key:"id",type:"int",align:"center"},{header:"Product Name",key:"name",type:"string"},{header:"SKU",key:"sku",type:"string"},{header:"Virtual",key:"virtual",type:"boolean"},{header:"Downloadable",key:"downloadable",type:"boolean"},{header:"Downloads",key:"downloads",type:"serialized"},{header:"Download Limit",key:"download_limit",type:"int"},{header:"Download Expiry",key:"download_expiry",type:"int"},{header:"Regular Price",key:"regular_price",type:"float"},{header:"Status",key:"status",type:["publish","draft","pending","private"],align:"center"}]}],Qe=Ot;var b=window.jQuery||jQuery,q=window.acex_phpDATA||{},sa=q.strings||{},{__:Q}=wp.i18n,ze={name:"New Template",sheet:"Products",columns:[{header:"Product ID",key:"id",type:"int"},{header:"Product Name",key:"name",type:"string"}]};(!q.templates||!q.templates.length)&&(q.templates=Qe.map(d=>({...d})));var Ge=class{constructor(){this.currentTemplate=0,this.templates=[],this.template=null,this.$list=null,this.$listContainer=null,this.$buttonEditTemplate=null,this.$target=null,this.$preview=null}async init(e){this.$target=e||null,this.isInitialized&&this.cleanup(),this.currentTemplate=q.prefs?.currentTemplate||0,this.templates=q.templates||[],this.templates.length||(this.templates=[{...ze}]),this.template=this.templates[this.currentTemplate]}events(){b("body").off("click.acex-export"),b("body").on("click.acex-export",".acex-template-item",e=>{let t=b(e.target).index();b(`.acex-template-item[data-index="${t}"]`).addClass("actus-active").siblings().removeClass("actus-active");let s=this.templates[t]||{...ze};this.template=s,this.currentTemplate=t,q.prefs.currentTemplate=t,q.prefs.save(),this.template.columns.length||this.$buttonEditTemplate.trigger("click"),b("body").trigger("acex::template-changed",[this.template])}),b("body").off("acex::template-changed.acex-export"),b("body").on("acex::template-changed.acex-export",async(e,t)=>{console.log("@@@ acex::template-changed.acex-export",t),V.setContainer(this.$preview),V.create(this.template)})}renderList(e,t=!0){e&&(this.$list=e.find(".acex-template-list"),this.$list.length||(this.$list=b('<div class="acex-template-list">').appendTo(e)),t&&b("<h3>").text(Q("Select a Template","actus-excel-for-woo")).appendTo(this.$list),this.$listContainer=b('<div class="acex-template-list-container">').appendTo(this.$list),this.templates.forEach((s,a)=>{let i=this.template===s,o=b(`<div class="acex-template-item" data-index="${a}">${s.name}</div>`).toggleClass("actus-active",i).appendTo(this.$listContainer)}),this.events())}renderPreview(){this.$preview=b('<div class="acex-products-preview">').appendTo(this.$target)}editInfo(){let e=b('<div class="acex-section acex-template-info">').appendTo(this.$target),t=b('<div class="acex-form">').appendTo(e),s=b('<div class="actus-form-group actus-flex">').appendTo(t);b('<label class="actus-label" for="template_name">').text(Q("Template Name:","actus-excel-for-woo")).appendTo(s),b(`<input class="actus-input" type="text" id="template_name" name="template_name" placeholder="${Q("Template Name","actus-excel-for-woo")}">`).val(this.template.name||"").appendTo(s).on("input",n=>{this.template.name=n.target.value,this.$listContainer.find(".acex-template-item.actus-active").text(this.template.name||Q("Unnamed Template","actus-excel-for-woo"))}),b('<button class="actus-btn actus-btn-secondary">').text("Add").appendTo(s).on("click",async n=>{if(n.preventDefault(),this.templates.filter(u=>!u.system).length>=1&&(this.check=await w.check("Upgrade to the Premium version to create more custom templates."),!this.check))return;let l={...ze};this.templates.push(l),this.template=this.templates[this.templates.length-1],this.edit()}),b('<button class="actus-btn actus-btn-primary">').text(Q("Save Template","actus-excel-for-woo")).appendTo(s).on("click",async n=>{if(n.preventDefault(),this.template.system&&(this.check=await w.check("Upgrade to the Premium version to modify default templates."),!this.check))return;let c=this.$listContainer.find(".acex-template-item.actus-active").index();this.templates[c]=this.template,b(n.target).prop("disabled",!0).html(q.SVG.loader),await B("acex_templates",this.templates),b(n.target).prop("disabled",!1).text(Q("Save Template","actus-excel-for-woo"))}),b('<button class="actus-btn actus-btn-danger">').html(q.SVG.trash).appendTo(s).on("click",async n=>{n.preventDefault();let c=this.$listContainer.find(".acex-template-item.actus-active").index();await x.confirm(Q("Are you sure you want to delete this template?","actus-excel-for-woo")+"<br>"+this.templates[c].name)&&(this.templates=this.templates.filter((u,h)=>h!==c),this.$listContainer.find(".acex-template-item").first().trigger("click"),b(n.target).prop("disabled",!0).html(q.SVG.loader),await B("acex_templates",this.templates),b(n.target).prop("disabled",!1).text(Q("Delete Template","actus-excel-for-woo")))})}async edit(){this.$target.empty(),b(".acex-button-reset-templates").length||b('<button class="actus-btn actus-btn-secondary acex-button-reset-templates">').html(Q("restore default templates","actus-excel-for-woo")).appendTo(".acex-export-body .acex-header-flex").click(()=>this.restoreDefault.bind(this)),this.renderList(this.$target,!1),this.editInfo(),b("<hr>").css({margin:"32px -24px"}).appendTo(this.$target),await Ve.render(this.$target,this.template),b("<hr>").css({margin:"32px -24px"}).appendTo(this.$target),this.$previewContainer=b('<div class="acex-template-preview">').appendTo(this.$target),V.setPreviewProducts([],"template"),V.setContainer(this.$previewContainer),V.create(this.template),b("body").off("acex::template-changed.template-edit"),b("body").on("acex::template-changed.template-edit",(e,t)=>{console.log("@@@ acex::template-changed.template-edit",t),this.edit()})}async restoreDefault(){await x.confirm(Q("Are you sure you want to restore the default templates?","actus-excel-for-woo")+"<br>"+Q("It will not affect your custom templates.","actus-excel-for-woo"))&&(this.templates=this.templates.filter(t=>!t.system),this.templates=[...Qe,...this.templates],q.templates=this.templates,await B("acex_templates",q.templates),x.success(Q("Default templates restored successfully.","actus-excel-for-woo")),this.edit())}cleanup(){b("body").off(".template-edit"),b(".acex-button-reset-templates").remove(),this.$list=null,this.$listContainer=null,Ve.cleanup(),V.removeDragHandlers()}},z=new Ge;var ca=window.jQuery||jQuery,C=window.acex_phpDATA||{},da=C.strings||{},{__:ua}=wp.i18n,We=class{constructor(){this.clientId="223138436133-bdhlmsj90t6rjhmv0vas42qu2cqtrb58.apps.googleusercontent.com",this.scopes={drive:["https://www.googleapis.com/auth/drive.file","https://www.googleapis.com/auth/spreadsheets"],ai:["https://www.googleapis.com/auth/generative-language","openid","email","profile"]},this.discoveryDocs=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest","https://sheets.googleapis.com/$discovery/rest?version=v4"],this.redirectUri="urn:ietf:wg:oauth:2.0:oob",this.status=null,this.connectionCache=null,this.cacheTime=null,this.init()}init(){document.addEventListener("DOMContentLoaded",async()=>{await this.showStatus()})}async acexCallback(){let e=new URLSearchParams(window.location.search),t={};for(let[i,o]of e.entries())t[i]=o;let s=e.get("page"),a=window.location.pathname;if(s&&(a+="?page="+encodeURIComponent(s)),window.history.replaceState({},document.title,a),C.prefs.google_connected=!0,C.prefs.google_connected_at=Date.now(),C.prefs.save(),t.status==="acex_google_ready"){if(!await x.confirm("Export Products to Google Sheets","Google Connected"))return"error";await me.export(z.template,ne,!0)}t.status}async OAuth(e="acex_google_ready",t="drive",s=!1){if(this.check=await w.check("Upgrade to the Premium version to use Google Sheets integration."),!this.check)return;let a=await this.isConnected();if(a&&a.connected&&!s)return Promise.resolve({success:!0,message:"Already connected",callback_flag:e});if(!await x.confirm(this.modalBody(),"Connect to Google Sheets",[],"medium"))return{success:!1,message:"User cancelled"};localStorage.removeItem("acex_oauth_result");let o=window.location.origin+"/wp-admin/admin-post.php?callback_flag="+encodeURIComponent(e),r=`https://license.actusanima.com/api/oauth/start?wp_site=${encodeURIComponent(window.location.origin)}&redirect=${encodeURIComponent(o)}&scope=${encodeURIComponent(t)}`,n=window.open(r,"GoogleOAuth","width=600,height=700,left=200,top=100");return n?new Promise(c=>{let l=!1,u=setInterval(()=>{let g=localStorage.getItem("acex_oauth_result");if(g){if(clearInterval(u),clearInterval(m),l)return;l=!0,localStorage.removeItem("acex_oauth_result");let f=JSON.parse(g);setTimeout(()=>{n&&!n.closed&&n.close()},500),f.type==="acex_oauth_success"?(this.connectionCache=null,this.cacheTime=null,C.prefs.google_connected=!0,C.prefs.google_connected_at=Date.now(),C.prefs.save(),this.showStatus(),c({success:!0,message:"Connected to Google",callback_flag:e})):(x.alert(f.message||"OAuth failed","Connection Failed"),c({success:!1,message:f.message}))}},300),h=0,p=Date.now(),m=setInterval(()=>{if(h++,h<20)return;let g=Date.now();if(!(g-p<1e3)){p=g;try{if(!n||n.closed||n.window===null){if(clearInterval(m),clearInterval(u),l)return;l=!0,setTimeout(()=>{let f=localStorage.getItem("acex_oauth_result");if(f){localStorage.removeItem("acex_oauth_result");let y=JSON.parse(f);y.type==="acex_oauth_success"?(this.connectionCache=null,this.cacheTime=null,C.prefs.google_connected=!0,C.prefs.google_connected_at=Date.now(),C.prefs.save(),this.showStatus(),c({success:!0,message:"Connected to Google",callback_flag:e})):(x.alert(y.message||"OAuth failed","Connection Failed"),c({success:!1,message:y.message}))}else console.log("\u26A0 OAuth window closed without completion"),c({success:!1,message:"Authentication cancelled"})},500)}}catch{}}},1e3)}):(x.alert("Please allow popups for this site to connect to Google.","Popup Blocked"),{success:!1,message:"Popup blocked"})}OAuthLocal(e="drive"){let s=`https://accounts.google.com/o/oauth2/v2/auth?${new URLSearchParams({client_id:this.clientId,redirect_uri:this.redirectUri,response_type:"code",scope:this.scopes[e].join(" "),access_type:"offline",prompt:"consent"}).toString()}`;window.location.href=s}async isConnected(){if(this.check=await w.check("Upgrade to the Premium version to use Google Sheets integration."),!!this.check){if(this.connectionCache&&this.cacheTime&&Date.now()-this.cacheTime<3e5)return this.connectionCache;try{let t=await(await fetch(C.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"actus_google_drive_check",nonce:C.nonce})})).json();return t.success?(C.prefs.google_connected=!0,C.prefs.google_connected_at=Date.now(),C.prefs.save(),this.connectionCache={connected:!0,email:t.data.email,name:t.data.name,picture:t.data.picture},this.cacheTime=Date.now(),this.connectionCache):(C.prefs.google_connected=!1,delete C.prefs.google_connected_at,C.prefs.save(),this.connectionCache={connected:!1,message:t.data.message,status:t.data.status},this.cacheTime=Date.now(),this.connectionCache)}catch(e){return console.error("Error checking Google connection:",e),{connected:!1,message:"Network error",status:"error"}}}}async showStatus(){if(this.check=await w.check(),!this.check)return;let e=document.querySelector(".acex-google-status-container");if(!e)return;let t=await this.isConnected();if(!t.connected){e.innerHTML="";return}let s=t.picture||"https://www.gstatic.com/images/branding/product/1x/drive_2020q4_48dp.png";e.innerHTML=`
			<div class="google-status-connected">
				<div class="google-status-info">
					<img src="${s}" alt="Google Avatar" class="google-avatar" />
					<div class="google-user-details">
						<span class="google-connected-label">
							Google Connected
						</span>
						<span class="google-email">${t.email}</span>
					</div>
				</div>
				<button class="google-disconnect-btn" title="Disconnect from Google Sheets">
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
						<path d="M18.36 6.64a9 9 0 11-12.73 0M12 2v10" stroke-width="2" stroke-linecap="round"/>
					</svg>
					Disconnect
				</button>
			</div>
		`;let a=e.querySelector(".google-disconnect-btn");a.addEventListener("click",async i=>{if(i.preventDefault(),await x.confirm(`<p>
					This will remove the connection to your Google account.<br>
					You can reconnect anytime.
				</p>`,"Disconnect from Google Sheets?","Disconnect")){a.disabled=!0,a.innerHTML='<span style="opacity:0.6">Disconnecting...</span>';let r=await this.disconnect();r.success?(x.alert("Successfully disconnected from Google Sheets.","Disconnected"),e.innerHTML=""):(x.alert(r.message||"Failed to disconnect. Please try again.","Error"),a.disabled=!1,a.innerHTML=`
						<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
							<path d="M18.36 6.64a9 9 0 11-12.73 0M12 2v10" stroke-width="2" stroke-linecap="round"/>
						</svg>
						Disconnect
					`)}})}async disconnect(){try{let t=await(await fetch(C.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"actus_google_disconnect",nonce:C.nonce})})).json();if(t.success)return this.connectionCache=null,this.cacheTime=null,C.prefs.google_connected=!1,delete C.prefs.google_connected_at,C.prefs.save(),console.log("Disconnected from Google Sheets"),{success:!0,message:"Disconnected successfully"};throw new Error(t.data.message||"Disconnect failed")}catch(e){return console.error("Error disconnecting from Google Sheets:",e),this.connectionCache=null,this.cacheTime=null,C.prefs.google_connected=!1,delete C.prefs.google_connected_at,C.prefs.save(),{success:!1,message:e.message}}}async genAI(){let e=new FormData;e.append("action","acex_aicall"),e.append("nonce",acex_phpDATA?.nonce||""),e.append("prompt","test");let t=await fetch(acex_phpDATA.ajax_url,{method:"POST",body:e});console.log("AI Response:",t);let s=await t.json();return console.log("AI Response:",s),s}async loadFile(e){let t=await this.OAuth("acex_google_load_file");if(!t||!t.success)return;let s=new FormData;s.append("action","acex_load_google_sheet"),s.append("nonce",acex_phpDATA?.nonce||""),s.append("fileid",e);let i=await(await fetch(acex_phpDATA.ajax_url,{method:"POST",body:s})).json();if(!i.success)return console.error("Failed to load Google Sheet:",i),null;let o=i.data,r=atob(o.content),n=new Uint8Array(r.length);for(let u=0;u<r.length;u++)n[u]=r.charCodeAt(u);let c=new Blob([n],{type:o.type});return new File([c],o.name,{type:o.type})}async deleteFile(e){let t=await this.OAuth("acex_google_delete_file");if(!t||!t.success)return;let s=new FormData;s.append("action","acex_delete_google_sheet"),s.append("nonce",acex_phpDATA?.nonce||""),s.append("fileid",e);let i=await(await fetch(acex_phpDATA.ajax_url,{method:"POST",body:s})).json();return i.success?!0:(console.error("Failed to delete Google Sheet:",i),null)}async uploadToGoogleSheets(e,t){try{let s=await e.xlsx.writeBuffer(),a=new Blob([s],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=new FormData;i.append("action","acex_upload_xlsx_to_google"),i.append("nonce",acex_phpDATA?.nonce||""),i.append("file",a,t),i.append("sheet_name",t.replace(".xlsx",""));let r=await(await fetch(acex_phpDATA.ajax_url,{method:"POST",body:i})).json();if(r.success)return{success:!0,sheetId:r.data.sheet_id,message:"File uploaded to Google Sheets successfully"};throw new Error(r.data.message||"Upload failed")}catch(s){return console.error("Error uploading to Google Sheets:",s),{success:!1,message:s.message}}}modalBody(){return`
<div class="google-auth-info">

	<div class="oauth-header">
		<svg class="oauth-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
			<path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
		</svg>
		<h3>Before you continue...</h3>
	</div>

	<p class="oauth-intro">
		You\u2019ll be redirected to Google to grant permissions<br>
		<strong>This is safe</strong> and handled securely by Google.
	</p>


	<div class="oauth-section">
		<h4>\u{1F510} Why We Need Access</h4>
		<p>We need permission to <strong>create new Google Sheets</strong> so you can export your product data directly to your Drive.</p>
	</div>

	<div class="privacy-note">
		\u{1F512} <strong>Your data stays private and secure</strong>
	</div>


	<div class="oauth-section oauth-section-safe">
		<h4>\u2713 We DON'T</h4>
		<ul>
			<li><strong>Access existing files</strong> \u2014 We can't see or touch your documents, photos, or other files</li>
			<li><strong>Read personal data</strong> \u2014 We only receive your email to identify you</li>
			<li><strong>Store credentials</strong> \u2014 Google handles all authentication securely</li>
			<li><strong>Share information</strong> \u2014 Your data never leaves your Google account and WordPress site</li>
		</ul>
	</div>

	<div class="oauth-section oauth-section-do">
		<h4>\u2713 We DO</h4>
		<ul>
			<li>Create <strong>new spreadsheet files</strong> when you click export</li>
			<li>Access <strong>only the files we create</strong></li>
			<li>Use <strong>Google's official OAuth</strong> (the gold standard for security)</li>
			<li>Let you disconnect anytime from your dashboard</li>
		</ul>
	</div>
		
	<div class="privacy-note">
		\u{1F512} <strong>Your data stays private and secure</strong>
	</div>
</div>`}},Z=new We;var ha=window.jQuery||jQuery,Je=class{constructor(e,t={}){this.container=typeof e=="string"?document.querySelector(e):e,this.options={maxFileSize:t.maxFileSize||10*1024*1024,allowedTypes:t.allowedTypes||["text/csv","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],multiple:t.multiple!==!1,uploadUrl:t.uploadUrl,instantUpload:!0,action:t.action,nonce:t.nonce||"",onUploadStart:t.onUploadStart||(()=>{}),onUploadProgress:t.onUploadProgress||(()=>{}),onUploadComplete:t.onUploadComplete||(()=>{}),onUploadError:t.onUploadError||(()=>{}),...t},this.files=[],this.isUploading=!1,this.boundHandlers={preventDefaults:this.preventDefaults.bind(this),highlight:this.highlight.bind(this),unhighlight:this.unhighlight.bind(this),handleDrop:this.handleDrop.bind(this)},this.init()}init(){this.createUploadArea(),this.bindEvents()}destroy(){if(!this.boundHandlers)return;["dragenter","dragover","dragleave","drop"].forEach(t=>{this.uploadZone&&this.uploadZone.removeEventListener(t,this.boundHandlers.preventDefaults,!1),document.body.removeEventListener(t,this.boundHandlers.preventDefaults,!1)}),["dragenter","dragover"].forEach(t=>{this.uploadZone&&this.uploadZone.removeEventListener(t,this.boundHandlers.highlight,!1)}),["dragleave","drop"].forEach(t=>{this.uploadZone&&this.uploadZone.removeEventListener(t,this.boundHandlers.unhighlight,!1)}),this.uploadZone&&this.uploadZone.removeEventListener("drop",this.boundHandlers.handleDrop,!1),this.container&&(this.container.innerHTML=""),this.uploadZone=null,this.uploadInput=null,this.browseBtn=null,this.filesContainer=null,this.actionsContainer=null,this.submitBtn=null,this.clearBtn=null,this.files=[],this.boundHandlers=null}createUploadArea(){this.container.innerHTML=`
            <div class="actus-upload-area">
                <div class="actus-upload-zone" data-state="idle">
                    <div class="actus-upload-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14,2 14,8 20,8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10,9 9,9 8,9"></polyline>
                        </svg>
                    </div>
                    <div class="actus-upload-text">
                        <h3>Drop your files here</h3>
                        <p>or <button type="button" class="actus-upload-browse">browse files</button></p>
                        <small>Supports CSV, XLS, XLSX files up to ${this.formatFileSize(this.options.maxFileSize)}</small>
                    </div>
                    <input type="file" class="actus-upload-input" ${this.options.multiple?"multiple":""} accept="${this.options.allowedTypes.join(",")}">
                </div>
                
                <div class="actus-upload-files"></div>
                
                <div class="actus-upload-actions" style="display: none;">
                    <button type="button" class="actus-btn actus-btn-primary actus-upload-submit">
                        <span class="actus-btn-text">Upload Files</span>
                        <span class="actus-btn-loader" style="display: none;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9c1.66 0 3.22.45 4.56 1.23"></path>
                            </svg>
                        </span>
                    </button>
                    <button type="button" class="actus-btn actus-btn-secondary actus-upload-clear">Clear All</button>
                </div>
            </div>
        `,this.uploadZone=this.container.querySelector(".actus-upload-zone"),this.uploadInput=this.container.querySelector(".actus-upload-input"),this.browseBtn=this.container.querySelector(".actus-upload-browse"),this.filesContainer=this.container.querySelector(".actus-upload-files"),this.actionsContainer=this.container.querySelector(".actus-upload-actions"),this.submitBtn=this.container.querySelector(".actus-upload-submit"),this.clearBtn=this.container.querySelector(".actus-upload-clear")}bindEvents(){["dragenter","dragover","dragleave","drop"].forEach(t=>{this.uploadZone.addEventListener(t,this.boundHandlers.preventDefaults,!1),document.body.addEventListener(t,this.boundHandlers.preventDefaults,!1)}),["dragenter","dragover"].forEach(t=>{this.uploadZone.addEventListener(t,this.boundHandlers.highlight,!1)}),["dragleave","drop"].forEach(t=>{this.uploadZone.addEventListener(t,this.boundHandlers.unhighlight,!1)}),this.uploadZone.addEventListener("drop",this.boundHandlers.handleDrop,!1),this.uploadInput.addEventListener("change",this.handleFileSelect.bind(this)),this.browseBtn.addEventListener("click",()=>this.uploadInput.click()),this.submitBtn.addEventListener("click",this.uploadFiles.bind(this)),this.clearBtn.addEventListener("click",this.clearFiles.bind(this))}preventDefaults(e){e.preventDefault(),e.stopPropagation()}highlight(){this.uploadZone.dataset.state="dragover"}unhighlight(){this.uploadZone.dataset.state="idle"}handleDrop(e){let s=e.dataTransfer.files;this.handleFiles(s)}handleFileSelect(e){this.handleFiles(e.target.files)}handleFiles(e){Array.from(e).forEach(s=>{this.validateFile(s)&&this.addFile(s)}),this.options.instantUpload?this.uploadFiles():this.updateUI()}validateFile(e){if(e.size>this.options.maxFileSize)return this.showError(`File "${e.name}" is too large. Maximum size is ${this.formatFileSize(this.options.maxFileSize)}.`),!1;if(!this.options.allowedTypes.includes(e.type)){let t=e.name.split(".").pop().toLowerCase();if(!["csv","xls","xlsx"].includes(t))return this.showError(`File "${e.name}" is not supported. Please upload CSV, XLS, or XLSX files.`),!1}return this.files.some(t=>t.name===e.name&&t.size===e.size)?(this.showError(`File "${e.name}" is already selected.`),!1):!0}addFile(e){let t={id:Date.now()+Math.random(),file:e,name:e.name,size:e.size,status:"pending",progress:0};this.files.push(t)}removeFile(e){this.files=this.files.filter(t=>t.id!==e),this.updateUI()}clearFiles(){this.files=[],this.updateUI()}updateUI(){this.renderFiles(),this.files.length>0?(this.actionsContainer.style.display="flex",this.uploadZone.dataset.state="has-files"):(this.actionsContainer.style.display="none",this.uploadZone.dataset.state="idle")}renderFiles(){this.filesContainer.innerHTML=this.files.map(e=>`
            <div class="actus-file-item" data-status="${e.status}">
                <div class="actus-file-icon">
                    ${this.getFileIcon(e.name)}
                </div>
                <div class="actus-file-info">
                    <div class="actus-file-name">${e.name}</div>
                    <div class="actus-file-size">${this.formatFileSize(e.size)}</div>
                </div>
                <div class="actus-file-progress">
                    <div class="actus-progress-bar">
                        <div class="actus-progress-fill" style="width: ${e.progress}%"></div>
                    </div>
                    <span class="actus-progress-text">${e.progress}%</span>
                </div>
                <div class="actus-file-status">
                    ${this.getStatusIcon(e.status)}
                </div>
                <button type="button" class="actus-file-remove" onclick="window.acexUpload.removeFile(${e.id})" ${e.status==="uploading"?"disabled":""}>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
        `).join("")}getFileIcon(e){let t=e.split(".").pop().toLowerCase(),s={csv:'<svg width="20" height="20" viewBox="0 0 24 24" fill="#10b981"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14,2 14,8 20,8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>',xls:'<svg width="20" height="20" viewBox="0 0 24 24" fill="#16a34a"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14,2 14,8 20,8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>',xlsx:'<svg width="20" height="20" viewBox="0 0 24 24" fill="#059669"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14,2 14,8 20,8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>'};return s[t]||s.csv}getStatusIcon(e){let t={pending:'<svg width="16" height="16" viewBox="0 0 24 24" fill="#6b7280"><circle cx="12" cy="12" r="10"></circle><polyline points="12,6 12,12 16,14"></polyline></svg>',uploading:'<svg width="16" height="16" viewBox="0 0 24 24" fill="#3b82f6" class="actus-spin"><path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9c1.66 0 3.22.45 4.56 1.23"></path></svg>',success:'<svg width="16" height="16" viewBox="0 0 24 24" fill="#10b981"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22,4 12,14.01 9,11.01"></polyline></svg>',error:'<svg width="16" height="16" viewBox="0 0 24 24" fill="#ef4444"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>'};return t[e]||t.pending}async uploadFiles(){if(!(this.isUploading||this.files.length===0)){if(this.isUploading=!0,this.updateUploadButton(!0),this.options.onUploadStart(this.files),!this.options.action){this.isUploading=!1,this.updateUploadButton(!1),this.options.onUploadComplete(this.files),this.clearFiles();return}for(let e of this.files)if(e.status!=="success")try{await this.uploadSingleFile(e)}catch(t){console.error("Upload error:",t),e.status="error",this.options.onUploadError(t,e)}this.isUploading=!1,this.updateUploadButton(!1),this.options.onUploadComplete(this.files),this.clearFiles()}}uploadSingleFile(e){return new Promise((t,s)=>{let a=new FormData;a.append("action",this.options.action),a.append("file",e.file),a.append("nonce",this.options.nonce);let i=new XMLHttpRequest;i.upload.addEventListener("progress",o=>{o.lengthComputable&&(e.progress=Math.round(o.loaded/o.total*100),this.options.onUploadProgress(e),this.updateUI())}),i.addEventListener("load",()=>{if(i.status===200)try{let o=JSON.parse(i.responseText);if(o.success)e.status="success",e.progress=100,e.response=o.data,t(o);else throw new Error(o.data||"Upload failed")}catch(o){e.status="error",s(o)}else e.status="error",s(new Error(`HTTP Error: ${i.status}`));this.updateUI()}),i.addEventListener("error",()=>{e.status="error",s(new Error("Network error")),this.updateUI()}),e.status="uploading",this.updateUI(),i.open("POST",this.options.uploadUrl),i.send(a)})}updateUploadButton(e){let t=this.submitBtn.querySelector(".actus-btn-text"),s=this.submitBtn.querySelector(".actus-btn-loader");e?(t.style.display="none",s.style.display="inline-block",this.submitBtn.disabled=!0):(t.style.display="inline-block",s.style.display="none",this.submitBtn.disabled=!1)}formatFileSize(e){if(e===0)return"0 Bytes";let t=1024,s=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,a)).toFixed(2))+" "+s[a]}showError(e){let t=this.container.querySelector(".actus-upload-error");t||(t=document.createElement("div"),t.className="actus-upload-error",this.container.insertBefore(t,this.container.firstChild)),t.innerHTML=`
            <div class="actus-alert actus-alert-error">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                </svg>
                <span>${e}</span>
                <button type="button" class="actus-alert-close">&times;</button>
            </div>
        `,setTimeout(()=>{t.parentNode&&t.remove()},5e3),t.querySelector(".actus-alert-close").addEventListener("click",()=>{t.remove()})}},ft=Je;var ga=window.jQuery||jQuery,J=window.acex_phpDATA||{},ya=J.strings||{},Ke=class{constructor(){this.ignore=!1,this.products=[],this.keys=[],this.modal=null,this.validationResults=[]}async validate(e,t,s){this.ignore=s,this.products=e||[],this.keys=t||[],this.validationResults=[];let a=JSON.parse(JSON.stringify(this.products));if(!this.keys.includes("id")&&!this.keys.includes("sku")&&this.validationResults.push({warnings:['There is no <strong>"id"</strong> or <strong>"sku"</strong> field in the imported data.<br>New products will be created for all rows.']}),this.keys.includes("id")){let c=a.filter(l=>l.type==="variation"&&l.parent_id&&!a.find(u=>u.id&&u.id===l.parent_id));c.length>0&&this.validationResults.push({warnings:[`
						There are <strong>${c.length}</strong> variations with missing parent IDs.<br>
						These variations will be ignored during import.
					`]}),a=a.filter(l=>!(l.type==="variation"&&l.parent_id&&!a.find(u=>u.id&&u.id===l.parent_id)))}else{let c=a.filter(u=>u.type==="variable"),l=a.filter(u=>u.type==="variation");l.length>0&&(this.validationResults.push({warnings:[`
						There are <strong>${c.length}</strong> variable products with <strong>${l.length}</strong> variations and no <strong>ID</strong> column.<br>
						Variations cannot be created without a parent <strong>ID</strong> and will be ignored.
					`]}),a=a.filter(u=>u.type!=="variation"))}let i=await this.validateAJAX(a,this.keys);this.validationResults.push({ajax:i}),this.products=a;let o={};for(let c in J.data_taxonomies)o[`existing_${c}`]=[],o[`missing_${c}`]=[];let r={all_attributes:[],all_values:{},missing_attributes:[],missing_values:{}},n="";for(let c of this.products){let l=this.validateProduct(c);l.length>0&&this.validationResults.push({product:c,errors:l}),o=await this.validateProductTaxonomies(o,c,t),r=await this.validateProductAttributes(r,c,t)}o.html="";for(let c in o)if(c.startsWith("missing_")){let l=o[c];c=c.replace("missing_",""),l.length>0&&(o.html+=`
					<div class="acex-field acex-field-${c} actus-flex">
						<h3>${l.length} Missing ${J.data_taxonomies[c].label}</h3>
						<label>
							<input type="radio" value="create" class="acex-input" name="acex-missing-${c}" checked />
							Create
						</label>
						<label>
							<input type="radio" value="skip" class="acex-input" name="acex-missing-${c}" />
							Skip
						</label>
					</div>`)}return this.validationResults.push({type:"taxonomies",taxonomies:o}),this.validationResults.push({type:"attributes",attributes:r}),this.validationResults}async validateProductAttributes(e,t,s){let a=e;if(s.includes("attributes")&&t.attributes){await j("attributes_terms");let i=t.attributes;try{let r=typeof i=="string"?JSON.parse(i):i;(Array.isArray(r)?r:typeof r=="object"?Object.entries(r).map(([c,l])=>({name:c,options:l})):[]).forEach(c=>{let l=c.slug||c.name||c.id,u=Array.isArray(c.options)?c.options:String(c.options).split(/,|\n/).map(p=>p.trim()).filter(Boolean);a.all_attributes.includes(l)||a.all_attributes.push(l),a.all_values[l]||(a.all_values[l]=[]),u.forEach(p=>{a.all_values[l].includes(p)||a.all_values[l].push(p)}),l=l.startsWith("pa_")?l.slice(3):l;let h=Object.values(J.product_attributes_terms||{}).find(p=>p.attribute_name===l);h?u.forEach(p=>{let m=String(p).toLowerCase().trim();h.options.includes(m)||h.terms&&h.terms.some(f=>f.slug===m||f.name.toLowerCase()===m)||(a.missing_values[l]||(a.missing_values[l]=[]),a.missing_values[l].includes(p)||a.missing_values[l].push(p))}):(a.missing_attributes.includes(l)||a.missing_attributes.push(l),a.missing_values[l]||(a.missing_values[l]=[]),u.forEach(p=>{a.missing_values[l].includes(p)||a.missing_values[l].push(p)}))})}catch(r){console.error("Error parsing attributes JSON:",r)}let o=0;Object.keys(a.missing_values).length>0&&Object.keys(a.missing_values).forEach(r=>{o+=a.missing_values[r].length}),(a.missing_attributes.length>0||o>0)&&(a.html="",a.html+=`
				<div class="acex-field acex-field-attributes actus-flex">
					<h3>`,a.missing_attributes.length>0&&(a.html+=`${a.missing_attributes.length} Missing Attributes`),o>0&&(a.missing_attributes.length>0&&(a.html+=" &amp;<br>"),a.html+=`${o} Missing Attribute Values`),a.html+=`
					</h3>
					<label>
						<input type="radio" value="create" class="acex-input" name="acex-missing-attributes" checked />
						Create
					</label>
					<label>
						<input type="radio" value="skip" class="acex-input" name="acex-missing-attributes" />
						Skip
					</label>
				</div>`)}return a}async validateProductTaxonomies(e,t,s){let a=JSON.parse(JSON.stringify(e));a.html="";for(let i in J.data_taxonomies)if(s.includes(i)&&t[i]){let o=J.data_taxonomies[i],r=Array.isArray(t[i])?t[i]:String(t[i]).split(/,|\n/).map(n=>n.trim()).filter(n=>n.length>0);await j(i),r.forEach((n,c)=>{let l=typeof n=="string"?this.decodeHtmlEntities(n):this.decodeHtmlEntities(n.slug);if(a[`existing_${i}`].includes(l)||a[`missing_${i}`].includes(l))return;J[`product_${i}`].find(h=>this.decodeHtmlEntities(h.slug)===l||h.id===n||h.term_id===n)?a[`existing_${i}`].push(l):a[`missing_${i}`].push(l)})}return a.html=a.html||e.html,a}validateProduct(e){let t=[];return!e.id&&e.sku,this.existInProduct("name",e)&&!e.name&&t.push("Product name cannot be empty."),this.existInProduct("price",e)&&e.price!==""&&isNaN(e.price)&&t.push("Price must be a valid number."),Object.keys(J.data_props).forEach(s=>{let a=J.data_props[s],i=a.type;if(!this.existInProduct(s,e))return;let o=e[s];if(!(e.type==="variation"&&J.data_mustBeInherited.includes(s))){if(i==="boolean"){let r=this.normalizeBoolean(o,s);r.error?t.push(r.message):e[s]=r}if(i==="int"||i==="float"){let r=this.validateNumeric(o,s,{allowEmpty:a.allow_empty});r.error?t.push(r.message):e[s]=r}if(i==="array"||i==="comma-separated"){let r=this.validateArrayField(o,s);r.error?t.push(...r.messages):e[s]=r}if(s==="type"){let r=this.validateProductType(e);r.error?t.push(r.message):e[s]=r.type}}}),t}existInProduct(e,t){return Object.prototype.hasOwnProperty.call(t,e)}decodeHtmlEntities(e){if(!e||typeof e!="string")return e;try{return decodeURIComponent(e)}catch{return e}let t=document.createElement("textarea");return t.innerHTML=e,t.value}normalizeBoolean(e,t){if(typeof e=="boolean")return e?!0:"";if(typeof e=="number")return e!==0?!0:"";let s=String(e).toLowerCase().trim();return["true","1","yes","on"].includes(s)?!0:["false","0","no","off",""].includes(s)||this.ignore?"":{error:!0,message:`Invalid boolean value "${e}" for field "${t}". Use: true/false, 1/0, yes/no`}}validateNumeric(e,t,s={}){if(e===null||e==="")return s.allowEmpty?null:{error:!0,message:`${t} cannot be empty`};let a=parseFloat(e);return isNaN(a)?this.ignore?0:{error:!0,message:`${t} must be a valid number, got "${e}"`}:s.min!==void 0&&a<s.min?this.ignore?0:{error:!0,message:`${t} must be >= ${s.min}, got ${a}`}:s.max!==void 0&&a>s.max?this.ignore?0:{error:!0,message:`${t} must be <= ${s.max}, got ${a}`}:["price","regular_price","sale_price"].includes(t)&&a<0?{value:a,warning:`${t} is negative (${a}). This may cause display issues.`}:a}validateArrayField(e,t,s="string"){if(!e)return[];if(Array.isArray(e)&&e.length===0)return[];let a;typeof e=="string"?a=e.split(/,|\n/).map(r=>r.trim()).filter(r=>r.length>0):Array.isArray(e)?a=e:a=[e];let i=a.map((r,n)=>{if(s==="number"){let c=parseInt(r);return isNaN(c)?{error:!0,message:`${t}[${n}]: "${r}" is not a valid number`}:c}return String(r).trim()}),o=i.filter(r=>r&&r.error);return o.length>0?{error:!0,messages:o.map(r=>r.message)}:i}validateProductType(e){let t=["simple","variable","grouped","external","variation"],s=e.type||"simple";return t.includes(s)?s==="external"&&!e.product_url?{error:!0,message:"External products must have a product_url",type:s}:s==="variable"&&(!e.attributes||!Array.isArray(e.attributes)||e.attributes.length===0)?{warning:!0,message:"Variable product has no attributes. Variations cannot be created.",type:s}:s==="grouped"&&(!e.grouped_products||!Array.isArray(e.grouped_products))?{warning:!0,message:"Grouped product has no children products defined.",type:s}:s==="variation"&&!e.parent_id?{error:!0,message:"Variation products must have a parent_id",type:s}:{type:s}:{error:!0,message:`Invalid product type "${s}". Must be one of: ${t.join(", ")}`,type:s}}validateSku(e,t=0){if(!e||e==="")return{valid:!0};e=String(e).trim();let s=this.getProductIdBySku(e);return s&&s!==t?{valid:!1,error:!0,message:`SKU "${e}" already exists for product ID ${s}. Please use a unique SKU or remove it to auto-generate.`}:{valid:!0,sku:e}}getProductIdBySku(e){let t=this.products.find(s=>s.sku===e);return t?t.id:null}async validateAJAX(e,t){return await lt(e,t.join(","))}},gt=new Ke;var oe=window.jQuery||jQuery,K=window.acex_phpDATA||{},Da=K.strings||{};function xt(d){return!0}function vt(d,e,t,s,a){let i=[];return d.eachRow((o,r)=>{if(r<=2)return;let n={};o.eachCell((c,l)=>{let u=e[l-1];if(t.length&&!t.includes(u)||!s&&!a.props.includes(u)||(K.data_props[u]=K.data_props[u]||{},u&&String(u).startsWith("0"))||u&&String(u)=="Auto-filled")return;let h=K.data_props[u].type;if(u){let p=c.value;K.data_props[u]&&h==="boolean"&&(typeof p=="string"&&(p=p.toLowerCase()),["true","1","yes","on"].includes(p)?p=!0:p="",p||(p="")),n[u]=p}}),Object.keys(n).length>0&&i.push(n)}),i}function bt(d,e){let t,s={};for(let a in K.data_taxonomies){let i=K.data_taxonomies[a],o=i.labels.menu_name||i.label||a;if(e[`create_${a}`]&&(t=d.getWorksheet(o),t)){let r=[];t.eachRow((n,c)=>{if(c<=2)return;let l={};n.eachCell((u,h)=>{let p=t.getRow(1).getCell(h).value;l[p]=u.value}),Object.keys(l).length>0&&r.push(l)}),s[`original_${a}`]=r}}if(e.create_attributes){if(t=d.getWorksheet("Attributes"),t){let a=[];t.eachRow((i,o)=>{if(o<=2)return;let r={};i.eachCell((n,c)=>{let l=t.getRow(1).getCell(c).value;r[l]=n.value}),Object.keys(r).length>0&&a.push(r)}),s.original_attributes=a}if(t=d.getWorksheet("Attribute Terms"),t){let a=[];t.eachRow((i,o)=>{if(o<=2)return;let r={};i.eachCell((n,c)=>{let l=t.getRow(1).getCell(c).value;r[l]=n.value}),Object.keys(r).length>0&&a.push(r)}),s.original_attribute_values=a}}return s}async function wt(d){d.prop("disabled",!0).html(K.SVG.loader);let e=await oe.ajax({url:acex_phpDATA.ajax_url,type:"POST",data:{action:"acex_check_orphaned",nonce:acex_phpDATA?.nonce}});e.success?yt(e.data.variations,d):(console.error("Error checking orphaned variations:",e),yt([],d))}function yt(d,e){let t;if(oe(".acex-orphaned-results").length?(t=oe(".acex-orphaned-results"),t.empty()):(t=oe('<div class="acex-orphaned-results" style="margin-top:20px;"></div>'),t.insertAfter(e)),e.remove(),!d||d.length===0){t.html("<p>No orphaned variations found.</p>");return}e=oe('<button type="button" class="actus-btn actus-btn-primary">Delete orphaned variations</button>'),e.on("click",()=>jt(d,e,t)),t.html(`<h3>${d.length} orphaned variations found.</h3>`),t.append(e);let s=oe('<ul class="acex-orphaned-list">');d.forEach(a=>{s.append(`<li><span>${a.ID}</span> - ${Lt(a.post_title||a.post_name)}</li>`)}),t.append(s)}async function jt(d,e,t){if(!await x.confirm(`Are you sure you want to delete ${d.length} orphaned variations? This action cannot be undone.`))return;e.prop("disabled",!0).html(K.SVG.loader);let a=d.map(i=>i.ID);oe.ajax({url:acex_phpDATA.ajax_url,type:"POST",data:{action:"acex_delete_orphaned",nonce:acex_phpDATA?.nonce,variation_ids:a},success:i=>{t.html(`<h3>${i.data.deleted_ids.length} orphaned variations deleted.</h3>`)},complete:()=>{e.remove()}})}function Lt(d){if(!d||typeof d!="string")return d;try{return decodeURIComponent(d)}catch{return d}}var U=window.jQuery||jQuery,X=window.acex_phpDATA||{},Na=X.strings||{},$t=100,{__:$e}=wp.i18n,Ye=class{constructor(){this.workbook=null,this.importOptions={},this.$mainContainer=U(".acex-main"),this.$uploadContainer=null,this.uploaderInstance=null,this.free=w.free}async init(){this.uploaderInstance&&this.cleanup(),this.$mainContainer.empty(),this.importOptions={},this.importNavigation(),this.$bodyContainer=U('<div class="acex-import-body">').appendTo(this.$mainContainer),this.$bodyHeader=U('<div class="acex-header-flex">').appendTo(this.$bodyContainer),this.$bodyTitle=U("<h2>").appendTo(this.$bodyHeader),this.$bodyNote=U("<p>").appendTo(this.$bodyHeader),this.check=await w.check()}cleanup(){this.uploaderInstance&&this.uploaderInstance.destroy(),this.$mainContainer.empty(),this.$uploadContainer=null,this.workbook=null,this.importOptions={}}importNavigation(){this.$navContainer=U('<div class="acex-navigation">').appendTo(this.$mainContainer),this.$navContainer.on("click",".acex-navigation-button",function(){U(this).addClass("actus-active").siblings(".acex-navigation-button").removeClass("actus-active")}),this.$buttonImportQuery=U('<button class="acex-navigation-button">').text($e("Import Sheet","actus-excel-for-woo")).appendTo(this.$navContainer),this.$buttonImportQuery.on("click",()=>{this.$bodyTitle.text($e("Import Sheet","actus-excel-for-woo")),this.$bodyNote.text("Import products from an Excel (.xlsx) file"),this.uploader()}),this.$buttonHistory=U('<button class="acex-navigation-button">').text($e("Google Sheets","actus-excel-for-woo")).appendTo(this.$navContainer),this.$buttonHistory.on("click",()=>{this.$bodyTitle.text($e("Google Sheets","actus-excel-for-woo")),this.$bodyNote.text(""),this.$bodyContainer.empty(),ee.renderGoogleSheetsList(this.$bodyContainer)}),setTimeout(()=>{this.$buttonImportQuery.trigger("click")},0)}uploader(){this.$bodyContainer.empty(),this.$uploadContainer=U('<div class="acex-upload-container">').appendTo(this.$bodyContainer),this.uploaderInstance=new ft(this.$uploadContainer[0],{onUploadComplete:e=>{this.fileUploaded(e[0])},onUploadError:(e,t)=>{console.error("Upload error:",e,t)}}),this.$orphanedButton=U('<button type="button" class="actus-btn actus-btn-primary" style="margin-left:10px;">Check for orphaned variations in your database</button>'),this.$orphanedButton.on("click",()=>wt(this.$orphanedButton)),this.$uploadContainer.append(this.$orphanedButton)}fileUploaded(e){this.importOptions={};let t=e.file||e;if(this.currentFilename=t.name,t){let s=new FileReader;s.onload=async a=>{let i=new ExcelJS.Workbook;try{let o=new x({title:"Import Product Data"});o.open(),o.showLoading("Loading Sheet..."),await i.xlsx.load(a.target.result),o.destroy(),this.excelLoaded(i)}catch(o){console.error("Error loading the Excel file:",o)}},s.readAsArrayBuffer(t)}else alert("Please select a file!")}async excelLoaded(e){this.workbook=e;let t=e.getWorksheet(1),s=[];if(t.getRow(2).eachCell((c,l)=>{!this.check&&!this.free.props.includes(c.value)||(s[l-1]=c.value)}),!xt(s)){x.error("Invalid Spreadsheet","","One or more field keys are invalid.","Please check and try again.");return}let o=await this.selectColumnsModal(s);if(!o)return;let r=vt(t,s,o,this.check,this.free);console.log("products:",r);let n=await gt.validate(r,o);console.log("Validation Results:",n),console.log("      AJAX Results:",n[0]?.ajax||n[1]?.ajax),n.length?this.validationModal(n,r):this.startImportModal(n,r)}validationModal(e,t){let s="",a=e.find(n=>n.taxonomies);s+=a?.taxonomies?.html||"";let i=e.find(n=>n.attributes);s+=i?.attributes?.html||"";let o=this.errorsAndWarnings(e);if(o.HTML&&(s+=o.HTML),!s){this.startImportModal(e,t);return}let r=new x({title:"Import Validation"});r.setContent(s),r.open(),r.updateButtons([{text:"Cancel",class:"actus-btn-secondary",onClick:n=>{n.destroy(),this.init()}},{text:"Continue to Import",class:"actus-btn-primary",onClick:n=>{if(a?.taxonomies?.html){for(let c in X.data_taxonomies)this.importOptions[`create_${c}`]=n.$body.find(`input[name="acex-missing-${c}"]:checked`).val()==="create"||"";this.importOptions.taxonomiesData=a.taxonomies||{}}i?.attributes?.html&&(this.importOptions.create_attributes=n.$body.find('input[name="acex-missing-attributes"]:checked').val()==="create"||"",this.importOptions.attributesData=i.attributes||{}),n.destroy(),this.startImportModal(e,t)}}])}errorsAndWarnings(e){let t={},s="",a="",i=0,o=0;return e.forEach((r,n)=>{r.errors&&r.errors.length>0&&(r.product&&(s+=`<h4>Product: ${r.product.name||r.product.slug||r.product.id||"in row "+(n+1+2)}</h4>`),s+="<ul>",r.errors.forEach(c=>{s+=`<li>${c}</li>`,i++}),s+="</ul>"),r.warnings&&r.warnings.length>0&&(r.product&&(a+=`<h4>Product: ${r.product.name||r.product.slug||r.product.id||"in row "+(n+1+2)}</h4>`),a+="<ul>",r.warnings.forEach(c=>{a+=`<li>${c}</li>`,o++}),a+="</ul>")}),i&&(s=`
			<p>Found <strong>${i} errors</strong> in the imported data. Please correct these errors before proceeding.</p>
			<div class="acex-validation-errors">${s}</div>
		`),a&&(a=`
			<br>
			<p>Found <strong>${o} warnings</strong> in the imported data. You may choose to proceed despite these warnings.</p>
			<div class="acex-validation-warnings">${a}</div>
		`),t.errors=i,t.warnings=o,t.HTML=s+a,t}async selectColumnsModal(e){return new Promise(t=>{let s=new x({title:"Select Columns",className:"acex-columns-modal"}),a=`<p>Please select the columns to import:</p>
				<div class="acex-select-columns-list">`;e.forEach((i,o)=>{a+=`
					<div class="acex-field acex-field-checkbox acex-select-column">
						<label>
							<input type="checkbox" class="acex-input" name="acex-column-key" value="${i}" checked />
							${i}
						</label>
					</div>
				`}),a+="</div>",s.setContent(a),s.updateButtons([{text:"Cancel",class:"actus-btn-secondary",onClick:i=>{i.destroy(),t("")}},{text:"Continue",class:"actus-btn-primary",onClick:i=>{let o=i.$body.find('input[name="acex-column-key"]:checked').map((r,n)=>n.value).get();i.destroy(),t(o)}}]),s.open()})}startImportModal(e,t){let s=new x({title:"Import Product Data",className:"acex-import-modal"});if(!t.length)s.setContent("<p>No products found matching your filters.</p>"),s.updateButtons([{text:"Close",class:"actus-btn-secondary",onClick:a=>{a.destroy(),this.init()}}]);else{s.setContent(`
				<h3 class="acex-products-title"><strong>${t.length} products</strong><br>parsed from the spreadsheet.</h3>
			`);let a=this.idValidationHtml(e);a&&s.addContent(a),s.addContent(`
				<div class="acex-import-status">
					You can now proceed to import these products into your WooCommerce store.<br>
				</div>
			`),s.addContent(`
				<div class="acex-field acex-field-checkbox acex-import-all-new">
					<label>
						<input type="checkbox" class="acex-input" />
						Import all as new products
					</label>
				</div>
			`),s.addContent(`
				<br><br>
				<h3 class="acex-center acex-faded">We recommend backing up your database before proceeding.</h3>
			`),s.updateButtons([{text:"Close",class:"actus-btn-secondary",onClick:i=>i.destroy()},{text:"Start Import",class:"actus-btn-primary",onClick:i=>{this.importOptions.importAsNew=s.$body.find(".acex-field-checkbox input.acex-input").is(":checked")||"",this.importProducts(t,e,s)}}])}s.open()}idValidationHtml(e){let t="",s=e[0]?.ajax||e[1]?.ajax;return s&&(t+='<div class="acex-import-circles">',s.create&&s.create.length&&(t+=`<div class="acex-import-circle">
					<div class="acex-circle acex-circle-green">
						<span>${s.create.length}</span>
					</div>
					products will be created new
				</div>`),s.update_ids&&s.update_ids.length&&(t+=`<div class="acex-import-circle">
					<div class="acex-circle">
						<span>${s.update_ids.length}</span>
					</div>
					products will be updated by ID
				</div>`),s.update_skus&&s.update_skus.length&&(t+=`<div class="acex-import-circle">
					<div class="acex-circle">
						<span>${s.update_skus.length}</span>
					</div>
					products will be updated by SKU
				</div>`),s.invalid&&s.invalid.length&&(t+=`<div class="acex-import-circle">
					<div class="acex-circle acex-circle-red">
						<span>${s.invalid.length}</span>
					</div>
					products are invalid (no name or type)
				</div>`),t+="</div>"),t}async importProducts(e,t,s){this.importOptions.ajaxData=t[0]?.ajax||t[1]?.ajax||{},this.check||e.length>$t&&(e=e.slice(0,$t));let a={},i={};i.import_as_new=this.importOptions.importAsNew||"",i.create=this.importOptions.ajaxData?.create,i.update_ids=this.importOptions.ajaxData?.update_ids,i.update_skus=this.importOptions.ajaxData?.update_skus,i.invalid=this.importOptions.ajaxData?.invalid;for(let l in X.data_taxonomies)i[`ignore_${l}`]=this.importOptions?.taxonomiesData?.[`missing_${l}`]?.length&&!this.importOptions[`create_${l}`];if(i.ignore_attributes=(this.importOptions?.attributesData?.missing_attributes?.length||this.importOptions?.attributesData?.missing_values?.length)&&!this.importOptions.create_attributes,this.check){let l=!1;this.importOptions.create_attributes&&(l=!0);for(let u in X.data_taxonomies)if(this.importOptions[`create_${u}`]){l=!0;break}if(l){let u="";for(let p in X.data_taxonomies){let m=X.data_taxonomies[p];this.importOptions[`create_${p}`]&&(u+="Creating "+m.label)}this.importOptions.create_attributes&&(u?u+=" and Attributes":u+="Creating Attributes"),s.showLoading(u);for(let p in X.data_taxonomies)a[p]=this.importOptions[`create_${p}`]?this.importOptions?.taxonomiesData?.[`missing_${p}`]:[];a.attributes=this.importOptions.create_attributes?this.importOptions?.attributesData?.missing_attributes:[],a.values=this.importOptions.create_attributes?this.importOptions?.attributesData?.missing_values:[],a={...a,...bt(this.workbook,this.importOptions)};let h=await rt(a)}}s.showLoading("Importing product data to WooCommerce..."),s.updateButtons([]),s.addContent(`<div class="acex-import-status">
			<div class="acex-progress-bar"><div class="acex-progress-bar-fill"></div></div>
			</div>`);let o=U(".acex-import-status"),r=await nt(e,{chunkSize:20,_data:i,onProgress:(l,u,h)=>{let p=Math.round(l/u*100);o.html(`
					<p>Processed ${l} of ${u} rows (${p}%)</p>
					<p>${h.successful} successful, ${h.failed} failed so far.</p>
					<div class="acex-progress-bar"><div class="acex-progress-bar-fill" style="width: ${p}%;"></div></div>
				`)}});s.destroy(),await ee.saveImport(this.currentFilename,r,e,this.importOptions);let n=[],c=[];r.results.forEach((l,u)=>{l.error&&n.push(`<span>row ${u+3}</span><i>\u29BF</i> ${l.message}`),l.warnings&&l.warnings.length>0&&(c=c.concat(l.warnings.map(h=>`<span>row ${u+3}</span><i>\u29BF</i> ${h}`)))}),r.failed==r.total?this.importErrors(r,n,c):r.failed||n.length||c.length?this.importWarnings(r,n,c):this.importSuccess(r)}async saveHistory(e,t){let s=[],a=[];return e.results.forEach((i,o)=>{i.error&&s.push(`Row ${o+3}: ${i.message}`),i.warnings&&i.warnings.length>0&&a.push(...i.warnings.map(r=>`Row ${o+3}: ${r}`))}),U.ajax({url:ajaxurl,method:"POST",data:{action:"acex_save_history",nonce:X.nonce,history_data:{filename:this.currentFilename||"unknown.xlsx",action_type:"import",total_rows:t.length,successful:e.successful,failed:e.failed,created:e.created,updated:e.updated,errors:s,warnings:a,metadata:this.importOptions}}})}importSuccess(e){x.success("Import Complete","Product import process has completed."+this.getCircles(e),{Successful:e.successful},"",t=>{this.init(),t.destroy()})}importWarnings(e,t,s){let a="";t.length&&(a='<ul class="acex-import-errors-list"><li>'+t.join("</li><li>")+"</li></ul>"),x.warning("Import Warning","Product import process has completed with issues."+this.getCircles(e)+a,s,i=>{this.init(),i.destroy()})}importErrors(e,t,s){let a="";t.length&&(a="<ul><li>"+t.join("</li><li>")+"</li></ul>"),x.error("Import Error","Product import process failed.",a,"",i=>{this.init(),i.destroy()})}getCircles(e){let t='<div class="acex-final-import-circles">';return e.created&&(t+=`<div class="acex-import-circle">
				<div class="acex-circle acex-circle-green">
					<span>${e.created}</span>
				</div>
				products created
			</div>`),e.updated&&(t+=`<div class="acex-import-circle">
				<div class="acex-circle">
					<span>${e.updated}</span>
				</div>
				products updated
			</div>`),e.failed&&(t+=`<div class="acex-import-circle">
				<div class="acex-circle acex-circle-red">
					<span>${e.failed}</span>
				</div>
				products failed
			</div>`),t+="</div>",t}},fe=new Ye;var P=window.jQuery||jQuery,Y=window.acex_phpDATA||{},Va=Y.strings||{},{__:Qa}=wp.i18n,Ze=class{constructor(){this.history=[],this.$target=null,this.$historyFilters=null,this.$historyList=null}init(e){this.$target=e,this.$target.empty(),this.$historyContainer=P('<div class="acex-history-container">').appendTo(this.$target),this.$historyFilters=P('<div class="acex-history-filters">').appendTo(this.$historyContainer),[{type:"",label:"All"},{type:"import",label:"Imports"},{type:"export",label:"Exports"}].forEach(s=>{let a=P('<button class="acex-filter-btn actus-btn actus-btn-secondary">').text(s.label).data("type",s.type).appendTo(this.$historyFilters);s.type===""&&a.addClass("actus-btn-primary"),a.on("click",i=>{this.$historyFilters.find(".acex-filter-btn").removeClass("actus-btn-primary"),P(i.currentTarget).addClass("actus-btn-primary"),this.render(s.type)})}),this.render()}load(e="",t=0){return new Promise((s,a)=>{P.ajax({url:ajaxurl,method:"POST",data:{action:"acex_get_history",nonce:Y.nonce,action_type:e,limit:20,offset:t},success:i=>{i.success?s(i.data):s({error:!0})},error:()=>{s({error:!0})}})})}async render(e="",t=0){P(".acex-history-list").remove(),this.$historyList=P('<div class="acex-history-list">').appendTo(this.$historyContainer);let s=P('<div class="acex-history-loader">Loading history...</div>');t===0?this.$historyList.html(s):this.$historyList.append(s);let a=await this.load(e,t);if(a.error){this.$historyList.html('<div class="acex-no-history">Error loading history</div>');return}let{records:i,total:o}=a;if(!i||i.length===0){t===0&&this.$historyList.html('<div class="acex-no-history">No history records found</div>');return}s.remove(),i.forEach(n=>{let c=this.createHistoryItem(n);this.$historyList.append(c)});let r=t+i.length;if(r<o){let n=P('<button class="acex-load-more">Load More</button>');n.on("click",()=>{n.remove(),this.render(e,r)}),this.$historyList.append(n)}}createHistoryItem(e){let t=e.action_type==="import",a=new Date(e.created_at).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}),i=e.total_rows>0?Math.round(e.successful/e.total_rows*100):0,o="success",r="Success";e.failed>0&&e.successful===0?(o="error",r="Failed"):e.failed>0&&(o="warning",r="Partial");let n=P(`
            <div class="acex-history-item" data-id="${e.id}">
                <div class="acex-history-header">
                    <div class="acex-history-icon ${t?"import":"export"}">
                        ${t?Y.SVG.import:Y.SVG.export}
                    </div>
                    <div class="acex-history-main">
                        <div class="acex-history-title">
                            <span class="acex-history-filename">${this.escapeHtml(e.filename)}</span>
                            <span class="acex-history-badge acex-badge-${e.action_type}">${e.action_type}</span>
                            <span class="acex-history-status acex-status-${o}">${r}</span>
                        </div>
                        <div class="acex-history-meta">
                            <span class="acex-history-date">${a}</span>
                        </div>
                    </div>
                    <div class="acex-history-actions">
                        <button class="acex-btn-icon acex-btn-details" title="View Details">
                            <i class="dashicons dashicons-visibility"></i>
                        </button>
                        <button class="acex-btn-icon acex-btn-delete" title="Delete">
                            <i class="dashicons dashicons-trash"></i>
                        </button>
                    </div>
                </div>
                
                <div class="acex-history-flex">
					<div class="acex-history-stats">
						${t?`
							<div class="acex-stat">
								<span class="acex-stat-label">Total</span>
								<span class="acex-stat-value">${e.total_rows}</span>
							</div>
							<div class="acex-stat acex-stat-success">
								<span class="acex-stat-label">Created</span>
								<span class="acex-stat-value">${e.created}</span>
							</div>
							<div class="acex-stat acex-stat-updated">
								<span class="acex-stat-label">Updated</span>
								<span class="acex-stat-value">${e.updated}</span>
							</div>
						`:`
							<div class="acex-stat">
								<span class="acex-stat-label">Total</span>
								<span class="acex-stat-value">${parseInt(e.total_rows)+parseInt(e.metadata.product_types.variations||0)}</span>
							</div>
							${e.metadata.product_types.simple>0?`
								<div class="acex-stat acex-stat-success">
									<span class="acex-stat-label">simple</span>
									<span class="acex-stat-value">${e.metadata.product_types.simple}</span>
								</div>
							`:""}
							${e.metadata.product_types.variable>0?`
								<div class="acex-stat acex-stat-updated">
									<span class="acex-stat-label">variable</span>
									<span class="acex-stat-value">${e.metadata.product_types.variable}</span>
								</div>
							`:""}
							${e.metadata.product_types.variations>0?`
								<div class="acex-stat acex-stat-updated">
									<span class="acex-stat-label">variations</span>
									<span class="acex-stat-value">${e.metadata.product_types.variations}</span>
								</div>
							`:""}
							${e.metadata.product_types.grouped>0?`
								<div class="acex-stat acex-stat-exported">
									<span class="acex-stat-label">grouped</span>
									<span class="acex-stat-value">${e.metadata.product_types.grouped}</span>
								</div>
							`:""}
							${e.metadata.product_types.external>0?`
								<div class="acex-stat acex-stat-exported">
									<span class="acex-stat-label">external</span>
									<span class="acex-stat-value">${e.metadata.product_types.external}</span>
								</div>
							`:""}
						`}
						${e.failed>0?`
							<div class="acex-stat acex-stat-failed">
								<span class="acex-stat-label">Failed</span>
								<span class="acex-stat-value">${e.failed}</span>
							</div>
						`:""}
					</div>
					
					${i<100?`
						<div class="acex-history-progress">
							<div class="acex-progress-bar">
								<div class="acex-progress-fill acex-progress-${o}" style="width: ${i}%"></div>
							</div>
							<span class="acex-progress-text">${i}% successful</span>
						</div>
					`:""}
					
					${e.google_sheet_url?`
						<div class="actus-flex-1"></div>
						<div class="acex-history-google">
							${Y.SVG["google-sheet"]}
							<a href="${e.google_sheet_url}" target="_blank" rel="noopener noreferrer">
								Open in Google Sheets
							</a>
							<button class="acex-btn-icon acex-btn-delete-google" title="Delete Google Sheet">
								<i class="dashicons dashicons-trash"></i>
							</button>
						</div>
					`:""}

                </div>
                

                <div class="acex-history-details" style="display: none;">
                    ${this.renderDetails(e)}
                </div>
            </div>
        `);return n.find(".acex-btn-details").on("click",()=>{n.find(".acex-history-details").slideToggle(200),n.toggleClass("expanded")}),n.find(".acex-btn-delete-google").on("click",()=>{this.deleteGoogleSheet(e.google_sheet_id,e.id,n)}),n.find(".acex-btn-delete").on("click",()=>{this.deleteHistoryRecord(e.id,n,e.google_sheet_id)}),n}renderDetails(e){let t='<div class="acex-details-content">';return e.errors&&e.errors.length>0&&(t+=`
				<div class="acex-details-section acex-details-errors">
					<h4><i class="dashicons dashicons-warning"></i> Errors (${e.errors.length})</h4>
					<ul>
						${e.errors.map(s=>`<li>${this.escapeHtml(s)}</li>`).join("")}
					</ul>
				</div>
			`),e.warnings&&e.warnings.length>0&&(t+=`
				<div class="acex-details-section acex-details-warnings">
					<h4><i class="dashicons dashicons-info"></i> Warnings (${e.warnings.length})</h4>
					<ul>
						${e.warnings.map(s=>`<li>${this.escapeHtml(s)}</li>`).join("")}
					</ul>
				</div>
			`),e.metadata&&(t+=`
				<div class="acex-details-section acex-details-metadata">
					<h4><i class="dashicons dashicons-admin-settings"></i> Metadata</h4>
					<pre>${JSON.stringify(e.metadata,null,2)}</pre>
				</div>
			`),t+="</div>",t}async renderGoogleSheetsList(e){let s=(await this.load()).records||[];P(".acex-google-sheets-list").remove();let a=P('<div class="acex-google-sheets-list">').appendTo(e);return s.forEach(i=>{if(i.google_sheet_url){let o=P(`
					<div class="acex-google-sheet-item" data-id="${i.google_sheet_id}">
						${Y.SVG["google-sheet"]}
						<div class="acex-google-sheet-date">${this.escapeHtml(i.created_at.substr(0,10))}</div>
						<div class="acex-google-sheet-name">${this.escapeHtml(i.metadata.template_name)}</div>
						<div class="actus-flex-1"></div>
						<div class="acex-google-sheet-rows">${parseInt(i.total_rows)} rows</div>
						<button class="actus-btn actus-btn-secondary actus-btn-import-sheet">
							Import to WooCommerce
						</button>
						<button class="actus-btn actus-btn-secondary">
							<a href="${i.google_sheet_url}" target="_blank" rel="noopener noreferrer">
								Open in Google Sheets
							</a>
						</button>
						<button class="acex-btn-icon acex-btn-delete-google" title="Delete Google Sheet">
							<i class="dashicons dashicons-trash"></i>
						</button>
					</div>
				`);a.append(o)}}),P("body").off("click.acex-google-import",".actus-btn-import-sheet"),P("body").on("click.acex-google-import",".actus-btn-import-sheet",async i=>{i.preventDefault();let r=P(i.currentTarget).closest(".acex-google-sheet-item").data("id"),n=new x;n.showLoading("Loading data from Google Sheet..."),n.open();let c=await Z.loadFile(r);n.close(),c&&fe.fileUploaded({file:c})}),a}async deleteGoogleSheet(e,t,s){if(!await x.confirm("Are you sure you want to delete this Google Sheet? This action cannot be undone.","Delete Google Sheet","Delete Google Sheet"))return;let i=new x;i.showLoading("Deleting Google Sheet..."),i.open();try{await Z.deleteFile(e)?(await P.ajax({url:ajaxurl,method:"POST",data:{action:"acex_update_history_google",nonce:Y.nonce,id:t,google_sheet_id:null,google_sheet_url:null}}),s.find(".acex-btn-delete-google").remove(),s.find(".acex-history-google").remove(),i.close(),x.success("Google Sheet deleted successfully")):(i.close(),x.error("Failed to delete Google Sheet",result.error||"Unknown error"))}catch(o){i.close(),x.error("Error deleting Google Sheet",o.message)}}async deleteHistoryRecord(e,t,s=null){let a="Are you sure you want to delete this history record?";if(s&&(a+='<br><br><strong style="color: #d63638;">Warning:</strong> This record has an associated Google Sheet that will also be deleted permanently.'),!await x.confirm(a,"Delete History Record","Delete Record"+(s?" & Google Sheet":"")))return;let o=new x;o.showLoading("Deleting record..."),o.open();try{s&&await Z.deleteFile(s);let r=await P.ajax({url:ajaxurl,method:"POST",data:{action:"acex_delete_history",nonce:Y.nonce,id:e}});o.close(),r.success?(t.fadeOut(300,()=>t.remove()),x.success("Record deleted successfully")):x.error("Failed to delete record",r.data)}catch(r){o.close(),x.error("Error deleting record",r.message)}}escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}async saveImport(e,t,s,a){let i=[],o=[];return t.results&&t.results.forEach((r,n)=>{r.error&&i.push(`Row ${n+3}: ${r.message}`),r.warnings&&r.warnings.length>0&&o.push(...r.warnings.map(c=>`Row ${n+3}: ${c}`))}),P.ajax({url:ajaxurl,method:"POST",data:{action:"acex_save_history",nonce:Y.nonce,history_data:{filename:e||"unknown.xlsx",action_type:"import",total_rows:s.length,successful:t.successful||0,failed:t.failed||0,created:t.created||0,updated:t.updated||0,errors:i,warnings:o,metadata:a}}})}async saveExport(e,t,s,a,i,o=null){let r={filename:e,action_type:"export",total_rows:t,exported:t,successful:t,failed:0,errors:[],warnings:[],metadata:{template_name:a?.name||"Export",format:o?"google":"xlsx",query:i||{},columns:a?.columns?.map(n=>n.key)||[],product_types:{simple:s?.simple_products||0,variable:s?.variable_products||0,variations:s?.variations||0,grouped:s?.grouped_products||0,external:s?.external_products||0,downloadable:s?.downloadable_products||0}}};return o&&o.sheetId&&(r.google_sheet_id=o.sheetId,r.google_sheet_url=`https://docs.google.com/spreadsheets/d/${o.sheetId}`),P.ajax({url:ajaxurl,method:"POST",data:{action:"acex_save_history",nonce:Y.nonce,history_data:r}})}},ee=new Ze;var Ht=window.jQuery||jQuery,kt=window.acex_phpDATA||{},ti=kt.strings||{},{__:_t}=wp.i18n,Xe=class{constructor(e,t){this.template=null,this.SelectProducts=null,this.DATA=kt,this.free=w.free}async export(e,t,s=!1){this.template=e,this.SelectProducts=t,this.check=await w.check();let a={};a=new x({title:"Export Products"});try{if(!this.template||!this.template.columns||this.template.columns.length===0){alert("Please select at least one column in the template before exporting.");return}let i=this.SelectProducts.query||{},o=await this.countQuery(a,i);if(o==="error")return;this.WB=new mt(this.template,i),this.workbook=await this.WB.createBase(),this.worksheet=await this.WB.createWorksheet();let r=await this.mainQuery(a,i,o),{allProducts:n,variations:c,simple_products:l,variable_products:u,grouped_products:h,external_products:p,downloadable_products:m}=r;a.showLoading(_t("Creating Excel File...","actus-excel-for-woo")),await this.WB.finalize();let g=await this.downloadWorkbook(this.workbook),f;s&&(a.showLoading(_t("Uploading to Google Sheets...","actus-excel-for-woo")),f=await Z.uploadToGoogleSheets(this.workbook,g)),await ee.saveExport(g,o,r,this.template,i,f),a.destroy(),this.check||o>LIMIT&&(o=LIMIT);let y={Template:this.template.name||"N/A","Products Exported":o};c&&(y["Products Exported"]+=` (+${c} variations)`),l&&(y["Simple Products"]=l),u&&(y["Variable Products"]=u),c&&(y.Variations=c),h&&(y["Grouped Products"]=h),p&&(y["External Products"]=p),m&&(y["Downloadable Products"]=m),f&&(y["Google Sheets Link"]=f.sheetId?`<a href="https://docs.google.com/spreadsheets/d/${f.sheetId}" target="_blank">Open Sheet</a>`:"-"),y["File Name"]=g,y.Format="Excel (.xlsx)",x.success("Export Successful!","Your products have been exported successfully.",y)}catch(i){a.destroy(),console.error("Export error:",i),x.error("Export Failed","An error occurred during the export process:",i.message,"Please try again or contact support if the problem persists.")}}async downloadWorkbook(e){let t=new Date().toISOString().slice(0,19).replace("T","_").replace(/-/g,"").replace(/:/g,""),s=`${this.template.name||"products"}_${t}.xlsx`,a=await e.xlsx.writeBuffer(),i=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=window.URL.createObjectURL(i),r=document.createElement("a");return r.href=o,r.download=s,r.click(),window.URL.revokeObjectURL(o),s}async countQuery(e,t){let s=await re(t,!0);if(!s){e.open(),e.setContent("<p>No products found matching your filters.</p>"),e.updateButtons([{text:"Close",class:"actus-btn-primary",onClick:r=>r.destroy()}]);return}let a=`You are about to export ${s} products.`,i;return this.check||(a+=`<br><br>Your current license only allows exporting up to ${LIMIT} products.`,s>LIMIT&&(a+=` To export all ${s} products, please upgrade to the Pro version.`),i=[{text:"Upgrade Now",class:"actus-btn-primary",onClick:r=>{r.destroy(),window.open("https://awexcel.actusanima.com/","_blank")}},{class:"actus-modal-flex-1"}]),await x.confirm(a,"Export Products",i)?s:"error"}async mainQuery(e,t,s){this.check||s>LIMIT&&(s=LIMIT);let a=50,i=Math.ceil(s/a);e.updateTitle(`Export ${s} Products`),e.showLoading('Fetching...<br><div class="acex-progress"></div>'),e.open();let o=Ht(".actus-modal .acex-progress"),r=[];o.html(`0/${s} products`);let n=0,c=0,l=0,u=0,h=0,p=0,m=0;for(let g=1;g<=i;g++){let f=await re(t,!1,a,g,!0);if(se("export","batch",f),!f||!f.products)throw new Error(`Failed to fetch products page ${g}`);n+=f.simple_products||0,c+=f.variable_products||0,l+=f.variations||0,u+=f.grouped_products||0,h+=f.external_products||0,p+=f.downloadable_products||0,this.WB.addProductRows(Object.values(f.products)),m+=Object.values(f.products).length;let y=`${m-l}/${s} products`;l&&(y+=`<br> + ${l} variations`),o.html(y),f.products=null}return se("export","fetched",{allProducts:r,simple_products:n,variable_products:c,variations:l,grouped_products:u,external_products:h,downloadable_products:p}),{allProducts:r,simple_products:n,variable_products:c,variations:l,grouped_products:u,external_products:h,downloadable_products:p}}},me=new Xe;var R=window.jQuery||jQuery,Rt=window.acex_phpDATA||{},ci=Rt.strings||{},{__:ge}=wp.i18n,et=class{constructor(){this.$mainContainer=R(".acex-main"),this.$buttonExportQuery=null,this.$buttonEditTemplate=null,this.$bodyContainer=null,this.$bodyTitle=null,this.$bodyNote=null,this.$bodyContainer=null}init(){this.isInitialized&&this.cleanup(),this.$mainContainer.empty(),this.exportNavigation(),this.exportBody(),z.init(this.$bodyContainer),this.isInitialized=!0}cleanup(){R("body").off(".acex-export"),this.$navContainer=null,this.$bodyContainer=null,this.$bodyHeader=null,this.$bodyTitle=null,this.$bodyNote=null,this.$selectAllButton=null,this.isInitialized=!1,z.cleanup()}exportNavigation(){this.$navContainer=R('<div class="acex-navigation">').appendTo(this.$mainContainer),this.$navContainer.on("click",".acex-navigation-button",function(){R(this).addClass("actus-active").siblings(".acex-navigation-button").removeClass("actus-active")}),this.$buttonExportQuery=R('<button class="acex-navigation-button">').text(ge("Export Sheet","actus-excel-for-woo")).appendTo(this.$navContainer),this.$buttonExportQuery.on("click",this.export.bind(this)),this.$buttonEditTemplate=R('<button class="acex-navigation-button">').text(ge("Edit Template","actus-excel-for-woo")).appendTo(this.$navContainer),this.$buttonEditTemplate.on("click",()=>{this.$bodyTitle.text(ge("Edit Template","actus-excel-for-woo")),this.$bodyNote.text(""),z.edit()}),setTimeout(()=>{this.$buttonExportQuery.trigger("click")},0)}exportBody(){this.$bodyContainer=R('<div class="acex-export-body">').appendTo(this.$mainContainer),this.$bodyHeader=R('<div class="acex-header-flex">').appendTo(this.$bodyContainer),this.$bodyTitle=R("<h2>").appendTo(this.$bodyHeader),this.$bodyNote=R("<p>").appendTo(this.$bodyHeader),this.$bodyContainer=R('<div class="acex-export-body-container">').appendTo(this.$bodyContainer)}async export(){this.$bodyTitle.text(ge("Export","actus-excel-for-woo")),this.$bodyNote.text(ge("Export products to an Excel (.xlsx) file","actus-excel-for-woo")),this.$bodyContainer.empty(),await ne.render(this.$bodyContainer,z.template),z.renderList(this.$bodyContainer),z.renderPreview(),z.$list.clone().prependTo(this.$bodyContainer),this.exportEvents()}exportEvents(){R("body").off("click.acex-export",".acex-button-export"),R("body").on("click.acex-export",".acex-button-export",async e=>{e.preventDefault(),await me.export(z.template,ne)}),R("body").off("click.acex-export",".acex-button-export-google"),R("body").on("click.acex-export",".acex-button-export-google",async e=>{e.preventDefault();let t=await Z.OAuth("acex_google_ready");if(t&&t.success){if(t.message!=="Already connected"&&!await Modal.confirm("Export Products to Google Sheets","Google Connected"))return"error";await me.export(z.template,ne,!0)}})}},tt=new et;var ce=window.jQuery||jQuery,Nt=window.acex_phpDATA||{},fi=Nt.strings||{},_={};_.activeComponents={exportSheet:null,importSheet:null};_.init=async()=>{_.navigation(),ce(".actus-admin-nav-button").first().trigger("click"),window.addEventListener("beforeunload",_.cleanupAll)};_.cleanupAll=()=>{console.log("Cleaning up all components..."),Object.keys(_.activeComponents).forEach(d=>{let e=_.activeComponents[d];e&&typeof e.cleanup=="function"&&(console.log(`Cleaning up ${d}`),e.cleanup()),_.activeComponents[d]=null})};_.navigation=()=>{ce(".actus-admin-nav-button").on("click",function(){let d=ce(this).attr("alt");d!=="export"&&_.activeComponents.exportSheet&&(typeof _.activeComponents.exportSheet.cleanup=="function"&&_.activeComponents.exportSheet.cleanup(),_.activeComponents.exportSheet=null),d!=="import"&&_.activeComponents.importSheet&&(typeof _.activeComponents.importSheet.cleanup=="function"&&_.activeComponents.importSheet.cleanup(),_.activeComponents.importSheet=null),d!=="history"&&_.activeComponents.history&&(typeof _.activeComponents.history.cleanup=="function"&&_.activeComponents.history.cleanup(),_.activeComponents.history=null),d!=="license"&&_.activeComponents.license&&(typeof _.activeComponents.license.cleanup=="function"&&_.activeComponents.license.cleanup(),_.activeComponents.license=null),ce(".actus-admin-nav-button").removeClass("actus-active"),ce(this).addClass("actus-active"),d=="home"&&(document.querySelector(".actus-admin-main").innerHTML=""),d=="export"&&(tt.init(),_.activeComponents.exportSheet=tt),d=="import"&&(fe.init(),_.activeComponents.importSheet=fe),d=="history"&&(ee.init(ce(".acex-main")),_.activeComponents.history=ee),d=="license"&&(w.start(),_.activeComponents.license=w)})};window.addEventListener("beforeunload",()=>{Object.values(_.activeComponents).forEach(d=>{d?.cleanup?.()})});var Ct=_;var Tt=localStorage.getItem("acex_preferences");window.acex_phpDATA.prefs=Tt?JSON.parse(Tt):{};window.acex_phpDATA.prefs.save=()=>{let d={...window.acex_phpDATA.prefs};delete d.save,localStorage.setItem("acex_preferences",JSON.stringify(d))};var Bt=window.acex_phpDATA||{},Di=Bt.strings||{};var{__:Ei}=wp.i18n;Mt();async function Mt(){await w.init(),Ct.init()}})();
